"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.addEndian = addEndian;
exports.readRecord = readRecord;
exports.getArrayBuffer = getArrayBuffer;
exports.calculateCRC = calculateCRC;

var _sdk = require("./sdk");

var _messages = require("./messages");

var _buffer = require("buffer/");

function addEndian(littleEndian, bytes) {
  var result = 0;
  if (!littleEndian) bytes.reverse();

  for (var i = 0; i < bytes.length; i++) {
    result += bytes[i] << (i << 3) >>> 0;
  }

  return result;
}

var timestamp = 0;
var lastTimeOffset = 0;
var CompressedTimeMask = 31;
var CompressedLocalMesgNumMask = 0x60;
var CompressedHeaderMask = 0x80;
var GarminTimeOffset = 631065600000;
var monitoring_timestamp = 0;

function readData(blob, fDef, startIndex, options) {
  if (fDef.endianAbility === true) {
    var temp = [];

    for (var i = 0; i < fDef.size; i++) {
      temp.push(blob[startIndex + i]);
    }

    var _Uint8Array = new Uint8Array(temp),
        buffer = _Uint8Array.buffer;

    var dataView = new DataView(buffer);

    try {
      switch (fDef.type) {
        case 'sint16':
          return dataView.getInt16(0, fDef.littleEndian);

        case 'uint16':
        case 'uint16z':
          return dataView.getUint16(0, fDef.littleEndian);

        case 'sint32':
          return dataView.getInt32(0, fDef.littleEndian);

        case 'uint32':
        case 'uint32z':
          return dataView.getUint32(0, fDef.littleEndian);

        case 'float32':
          return dataView.getFloat32(0, fDef.littleEndian);

        case 'float64':
          return dataView.getFloat64(0, fDef.littleEndian);

        case 'uint32_array':
          var array32 = [];

          for (var _i = 0; _i < fDef.size; _i += 4) {
            array32.push(dataView.getUint32(_i, fDef.littleEndian));
          }

          return array32;

        case 'uint16_array':
          {
            var array = [];

            for (var _i2 = 0; _i2 < fDef.size; _i2 += 2) {
              array.push(dataView.getUint16(_i2, fDef.littleEndian));
            }

            return array;
          }

        default:
          throw Error('No type');
      }
    } catch (e) {
      if (!options.force) {
        throw e;
      }
    }

    return addEndian(fDef.littleEndian, temp);
  }

  if (fDef.type === 'string') {
    var _temp = [];

    for (var _i3 = 0; _i3 < fDef.size; _i3++) {
      if (blob[startIndex + _i3]) {
        _temp.push(blob[startIndex + _i3]);
      }
    }

    return _buffer.Buffer.from(_temp).toString('utf-8');
  }

  if (fDef.type === 'byte_array') {
    var _temp2 = [];

    for (var _i4 = 0; _i4 < fDef.size; _i4++) {
      _temp2.push(blob[startIndex + _i4]);
    }

    return _temp2;
  }

  return blob[startIndex];
}

function formatByType(data, type, scale, offset) {
  var off = offset ? offset : 0;

  switch (type) {
    case 'date_time':
    case 'local_date_time':
      return new Date(data * 1000 + GarminTimeOffset);

    case 'sint32':
      return data * _sdk.FITSDK.scConst;

    case 'uint8':
    case 'sint16':
    case 'uint32':
    case 'uint16':
      return scale ? data / scale + off : data;

    case 'uint32_array':
    case 'uint16_array':
      return data.map(function (dataItem) {
        if (scale) {
          return dataItem / scale + off;
        }

        return dataItem;
      });

    default:
      {
        if (!type) {
          return data;
        }

        if (!_sdk.FITSDK.types.hasOwnProperty(type)) {
          return data;
        }

        var t = _sdk.FITSDK.types[type];
        var tKeys = Object.keys(t); // Quick check for a mask

        var values = [];
        tKeys.forEach(function (key) {
          values.push(t[parseInt(key)]);
        });

        if (values.indexOf('mask') === -1) {
          return t[data];
        }

        var dataItem = {};
        tKeys.forEach(function (key) {
          var item = t[parseInt(key)];

          if (item === 'mask') {
            dataItem['value'] = data & parseInt(key);
          } else {
            dataItem[item] = !!((data & parseInt(key)) >> 7); // Not sure if we need the >> 7 and casting to boolean but from all
            // the masked props of fields so far this seems to be the case
          }
        });
        return dataItem;
      }
  }
}

function isInvalidValue(data, type) {
  switch (type) {
    case 'enum':
      return data === 0xFF;

    case 'sint8':
      return data === 0x7F;

    case 'uint8':
      return data === 0xFF;

    case 'sint16':
      return data === 0x7FFF;

    case 'uint16':
      return data === 0xFFFF;

    case 'sint32':
      return data === 0x7FFFFFFF;

    case 'uint32':
      return data === 0xFFFFFFFF;

    case 'string':
      return data === 0x00;

    case 'float32':
      return data === 0xFFFFFFFF;

    case 'float64':
      return data === 0xFFFFFFFFFFFFFFFF;

    case 'uint8z':
      return data === 0x00;

    case 'uint16z':
      return data === 0x0000;

    case 'uint32z':
      return data === 0x000000;

    case 'byte':
      return data === 0xFF;

    case 'sint64':
      return data === 0x7FFFFFFFFFFFFFFF;

    case 'uint64':
      return data === 0xFFFFFFFFFFFFFFFF;

    case 'uint64z':
      return data === 0x0000000000000000;

    default:
      return false;
  }
}

function convertTo(data, unitsList, speedUnit) {
  var unitObj = _sdk.FITSDK.options[unitsList][speedUnit];
  return unitObj ? data * unitObj.multiplier + unitObj.offset : data;
}

function applyOptions(data, field, options) {
  switch (field) {
    case 'speed':
    case 'enhanced_speed':
    case 'vertical_speed':
    case 'avg_speed':
    case 'max_speed':
    case 'speed_1s':
    case 'ball_speed':
    case 'enhanced_avg_speed':
    case 'enhanced_max_speed':
    case 'avg_pos_vertical_speed':
    case 'max_pos_vertical_speed':
    case 'avg_neg_vertical_speed':
    case 'max_neg_vertical_speed':
      // !!Â because options have already been checked
      return convertTo(data, 'speedUnits', options.speedUnit);

    case 'distance':
    case 'total_distance':
    case 'enhanced_avg_altitude':
    case 'enhanced_min_altitude':
    case 'enhanced_max_altitude':
    case 'enhanced_altitude':
    case 'height':
    case 'odometer':
    case 'avg_stroke_distance':
    case 'min_altitude':
    case 'avg_altitude':
    case 'max_altitude':
    case 'total_ascent':
    case 'total_descent':
    case 'altitude':
    case 'cycle_length':
    case 'auto_wheelsize':
    case 'custom_wheelsize':
    case 'gps_accuracy':
      return convertTo(data, 'lengthUnits', options.lengthUnit);

    case 'temperature':
    case 'avg_temperature':
    case 'max_temperature':
      return convertTo(data, 'temperatureUnits', options.temperatureUnit);

    default:
      return data;
  }
}

function readRecord(blob, messageTypes, developerFields, startIndex, options, startDate, pausedTime) {
  var recordHeader = blob[startIndex];
  var localMessageType = recordHeader & 15;

  if ((recordHeader & CompressedHeaderMask) === CompressedHeaderMask) {
    //compressed timestamp
    var timeoffset = recordHeader & CompressedTimeMask;
    timestamp += timeoffset - lastTimeOffset & CompressedTimeMask;
    lastTimeOffset = timeoffset;
    localMessageType = (recordHeader & CompressedLocalMesgNumMask) >> 5;
  } else if ((recordHeader & 64) === 64) {
    // is definition message
    // startIndex + 1 is reserved
    var hasDeveloperData = (recordHeader & 32) === 32;
    var lEnd = blob[startIndex + 2] === 0;
    var numberOfFields = blob[startIndex + 5];
    var numberOfDeveloperDataFields = hasDeveloperData ? blob[startIndex + 5 + numberOfFields * 3 + 1] : 0;
    var mTypeDef = {
      littleEndian: lEnd,
      globalMessageNumber: addEndian(lEnd, [blob[startIndex + 3], blob[startIndex + 4]]),
      numberOfFields: numberOfFields + numberOfDeveloperDataFields,
      fieldDefs: []
    };

    var _message = (0, _messages.getFitMessage)(mTypeDef.globalMessageNumber);

    for (var i = 0; i < numberOfFields; i++) {
      var fDefIndex = startIndex + 6 + i * 3;
      var baseType = blob[fDefIndex + 2];

      var _message$getAttribute = _message.getAttributes(blob[fDefIndex]),
          field = _message$getAttribute.field,
          type = _message$getAttribute.type;

      var fDef = {
        type: type,
        fDefNo: blob[fDefIndex],
        size: blob[fDefIndex + 1],
        endianAbility: (baseType & 128) === 128,
        littleEndian: lEnd,
        baseTypeNo: baseType & 15,
        name: field,
        dataType: (0, _messages.getFitMessageBaseType)(baseType & 15)
      };
      mTypeDef.fieldDefs.push(fDef);
    } // numberOfDeveloperDataFields = 0 so it wont crash here and wont loop


    for (var _i5 = 0; _i5 < numberOfDeveloperDataFields; _i5++) {
      // If we fail to parse then try catch
      try {
        var _fDefIndex = startIndex + 6 + numberOfFields * 3 + 1 + _i5 * 3;

        var fieldNum = blob[_fDefIndex];
        var size = blob[_fDefIndex + 1];
        var devDataIndex = blob[_fDefIndex + 2];
        var devDef = developerFields[devDataIndex][fieldNum];
        var _baseType = devDef.fit_base_type_id;
        var _fDef = {
          type: _sdk.FITSDK.types.fit_base_type[_baseType],
          size: size,
          fDefNo: fieldNum,
          endianAbility: (_baseType & 128) === 128,
          littleEndian: lEnd,
          baseTypeNo: _baseType & 15,
          name: devDef.field_name,
          dataType: (0, _messages.getFitMessageBaseType)(_baseType & 15),
          scale: devDef.scale || 1,
          offset: devDef.offset || 0,
          developerDataIndex: devDataIndex,
          isDeveloperField: true
        };
        mTypeDef.fieldDefs.push(_fDef);
      } catch (e) {
        if (options.force) {
          continue;
        }

        throw e;
      }
    }

    messageTypes[localMessageType] = mTypeDef;
    var nextIndex = startIndex + 6 + mTypeDef.numberOfFields * 3;
    var nextIndexWithDeveloperData = nextIndex + 1;
    return {
      messageType: 'definition',
      nextIndex: hasDeveloperData ? nextIndexWithDeveloperData : nextIndex
    };
  }

  var messageType = messageTypes[localMessageType] || messageTypes[0]; // TODO: handle compressed header ((recordHeader & 128) == 128)
  // uncompressed header

  var messageSize = 0;
  var readDataFromIndex = startIndex + 1;
  var fields = {};
  var message = (0, _messages.getFitMessage)(messageType.globalMessageNumber);

  for (var _i6 = 0; _i6 < messageType.fieldDefs.length; _i6++) {
    var _fDef2 = messageType.fieldDefs[_i6];
    var data = readData(blob, _fDef2, readDataFromIndex, options);

    if (!isInvalidValue(data, _fDef2.type)) {
      if (_fDef2.isDeveloperField && _fDef2.name) {
        var _field = _fDef2.name;
        var _type = _fDef2.type,
            scale = _fDef2.scale,
            offset = _fDef2.offset;
        fields[_fDef2.name] = applyOptions(formatByType(data, _type, scale, offset), _field, options);
      } else {
        var _message$getAttribute2 = message.getAttributes(_fDef2.fDefNo),
            _field2 = _message$getAttribute2.field,
            _type2 = _message$getAttribute2.type,
            _scale = _message$getAttribute2.scale,
            _offset = _message$getAttribute2.offset;

        if (_field2 !== 'unknown' && _field2 !== '' && _field2 !== undefined) {
          fields[_field2] = applyOptions(formatByType(data, _type2, _scale, _offset), _field2, options);
        }
      }

      if (message.name === 'record' && options.elapsedRecordField && fields.timestamp) {
        fields.elapsed_time = (fields.timestamp - startDate) / 1000;
        fields.timer_time = fields.elapsed_time - pausedTime;
      }
    }

    readDataFromIndex += _fDef2.size;
    messageSize += _fDef2.size;
  }

  if (message.name === 'field_description') {
    if (fields.field_definition_number && fields.developer_data_index) {
      developerFields[fields.developer_data_index] = developerFields[fields.developer_data_index] || [];
      developerFields[fields.developer_data_index][fields.field_definition_number] = fields;
    }
  }

  if (message.name === 'monitoring') {
    //we need to keep the raw timestamp value so we can calculate subsequent timestamp16 fields
    if (fields.timestamp) {
      monitoring_timestamp = fields.timestamp;
      fields.timestamp = new Date(fields.timestamp * 1000 + GarminTimeOffset).getTime();
    }

    if (fields.timestamp16 && !fields.timestamp) {
      monitoring_timestamp += fields.timestamp16 - (monitoring_timestamp & 0xFFFF) & 0xFFFF; //fields.timestamp = monitoring_timestamp;

      fields.timestamp = new Date(monitoring_timestamp * 1000 + GarminTimeOffset).getTime();
    }
  }

  var result = {
    messageType: message.name,
    nextIndex: startIndex + messageSize + 1,
    message: fields
  };
  return result;
}

function getArrayBuffer(buffer) {
  if (buffer instanceof ArrayBuffer) {
    return buffer;
  }

  var ab = new ArrayBuffer(buffer.length);
  var view = new Uint8Array(ab);

  for (var i = 0; i < buffer.length; ++i) {
    view[i] = buffer[i];
  }

  return ab;
}

function calculateCRC(blob, start, end) {
  var crcTable = [0x0000, 0xCC01, 0xD801, 0x1400, 0xF001, 0x3C00, 0x2800, 0xE401, 0xA001, 0x6C00, 0x7800, 0xB401, 0x5000, 0x9C01, 0x8801, 0x4400];
  var crc = 0;

  for (var i = start; i < end; i++) {
    var _byte = blob[i];
    var tmp = crcTable[crc & 0xF];
    crc = crc >> 4 & 0x0FFF;
    crc = crc ^ tmp ^ crcTable[_byte & 0xF];
    tmp = crcTable[crc & 0xF];
    crc = crc >> 4 & 0x0FFF;
    crc = crc ^ tmp ^ crcTable[_byte >> 4 & 0xF];
  }

  return crc;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9iaW5hcnkudHMiXSwibmFtZXMiOlsiYWRkRW5kaWFuIiwibGl0dGxlRW5kaWFuIiwiYnl0ZXMiLCJyZXN1bHQiLCJyZXZlcnNlIiwiaSIsImxlbmd0aCIsInRpbWVzdGFtcCIsImxhc3RUaW1lT2Zmc2V0IiwiQ29tcHJlc3NlZFRpbWVNYXNrIiwiQ29tcHJlc3NlZExvY2FsTWVzZ051bU1hc2siLCJDb21wcmVzc2VkSGVhZGVyTWFzayIsIkdhcm1pblRpbWVPZmZzZXQiLCJtb25pdG9yaW5nX3RpbWVzdGFtcCIsInJlYWREYXRhIiwiYmxvYiIsImZEZWYiLCJzdGFydEluZGV4Iiwib3B0aW9ucyIsImVuZGlhbkFiaWxpdHkiLCJ0ZW1wIiwic2l6ZSIsInB1c2giLCJVaW50OEFycmF5IiwiYnVmZmVyIiwiZGF0YVZpZXciLCJEYXRhVmlldyIsInR5cGUiLCJnZXRJbnQxNiIsImdldFVpbnQxNiIsImdldEludDMyIiwiZ2V0VWludDMyIiwiZ2V0RmxvYXQzMiIsImdldEZsb2F0NjQiLCJhcnJheTMyIiwiYXJyYXkiLCJFcnJvciIsImUiLCJmb3JjZSIsIkJ1ZmZlciIsImZyb20iLCJ0b1N0cmluZyIsImZvcm1hdEJ5VHlwZSIsImRhdGEiLCJzY2FsZSIsIm9mZnNldCIsIm9mZiIsIkRhdGUiLCJGSVRTREsiLCJzY0NvbnN0IiwibWFwIiwiZGF0YUl0ZW0iLCJ0eXBlcyIsImhhc093blByb3BlcnR5IiwidCIsInRLZXlzIiwiT2JqZWN0Iiwia2V5cyIsInZhbHVlcyIsImZvckVhY2giLCJrZXkiLCJwYXJzZUludCIsImluZGV4T2YiLCJpdGVtIiwiaXNJbnZhbGlkVmFsdWUiLCJjb252ZXJ0VG8iLCJ1bml0c0xpc3QiLCJzcGVlZFVuaXQiLCJ1bml0T2JqIiwibXVsdGlwbGllciIsImFwcGx5T3B0aW9ucyIsImZpZWxkIiwibGVuZ3RoVW5pdCIsInRlbXBlcmF0dXJlVW5pdCIsInJlYWRSZWNvcmQiLCJtZXNzYWdlVHlwZXMiLCJkZXZlbG9wZXJGaWVsZHMiLCJzdGFydERhdGUiLCJwYXVzZWRUaW1lIiwicmVjb3JkSGVhZGVyIiwibG9jYWxNZXNzYWdlVHlwZSIsInRpbWVvZmZzZXQiLCJoYXNEZXZlbG9wZXJEYXRhIiwibEVuZCIsIm51bWJlck9mRmllbGRzIiwibnVtYmVyT2ZEZXZlbG9wZXJEYXRhRmllbGRzIiwibVR5cGVEZWYiLCJnbG9iYWxNZXNzYWdlTnVtYmVyIiwiZmllbGREZWZzIiwibWVzc2FnZSIsImZEZWZJbmRleCIsImJhc2VUeXBlIiwiZ2V0QXR0cmlidXRlcyIsImZEZWZObyIsImJhc2VUeXBlTm8iLCJuYW1lIiwiZGF0YVR5cGUiLCJmaWVsZE51bSIsImRldkRhdGFJbmRleCIsImRldkRlZiIsImZpdF9iYXNlX3R5cGVfaWQiLCJmaXRfYmFzZV90eXBlIiwiZmllbGRfbmFtZSIsImRldmVsb3BlckRhdGFJbmRleCIsImlzRGV2ZWxvcGVyRmllbGQiLCJuZXh0SW5kZXgiLCJuZXh0SW5kZXhXaXRoRGV2ZWxvcGVyRGF0YSIsIm1lc3NhZ2VUeXBlIiwibWVzc2FnZVNpemUiLCJyZWFkRGF0YUZyb21JbmRleCIsImZpZWxkcyIsInVuZGVmaW5lZCIsImVsYXBzZWRSZWNvcmRGaWVsZCIsImVsYXBzZWRfdGltZSIsInRpbWVyX3RpbWUiLCJmaWVsZF9kZWZpbml0aW9uX251bWJlciIsImRldmVsb3Blcl9kYXRhX2luZGV4IiwiZ2V0VGltZSIsInRpbWVzdGFtcDE2IiwiZ2V0QXJyYXlCdWZmZXIiLCJBcnJheUJ1ZmZlciIsImFiIiwidmlldyIsImNhbGN1bGF0ZUNSQyIsInN0YXJ0IiwiZW5kIiwiY3JjVGFibGUiLCJjcmMiLCJieXRlIiwidG1wIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBSU8sU0FBU0EsU0FBVCxDQUFtQkMsWUFBbkIsRUFBMENDLEtBQTFDLEVBQW1FO0FBQ3hFLE1BQUlDLE1BQU0sR0FBRyxDQUFiO0FBQ0EsTUFBSSxDQUFDRixZQUFMLEVBQW1CQyxLQUFLLENBQUNFLE9B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QUFBQSxHQUFHLEdBQUlBLEdBQUcsSUFBSSxDQUFSLEdBQWEsTUFBbkI7QUFDQUEsSUFBQUEsR0FBRyxHQUFHQSxHQUFHLEdBQUdFLEdBQU4sR0FBWUgsUUFBUSxDQUFFRSxLQUFJLElBQUksQ0FBVCxHQUFjLEdBQWYsQ0FBMUI7QUFDRDs7QUFFRCxTQUFPRCxHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGSVRTREsgfSBmcm9tICcuL3Nkayc7XG5pbXBvcnQgeyBnZXRGaXRNZXNzYWdlLCBnZXRGaXRNZXNzYWdlQmFzZVR5cGUgfSBmcm9tICcuL21lc3NhZ2VzJztcbmltcG9ydCB7IEJ1ZmZlciB9IGZyb20gJ2J1ZmZlci8nO1xuaW1wb3J0IHsgVHlwZURlZiwgRGVmLCBNZXNzYWdlLCBGaWVsZHMsIE1lc3NhZ2VUeXBlcyxcbiAgRGV2ZWxvcGVyRmllbGRzLCBGaXRQYXJzZXJPcHRpb25zLCBSZWFkUmVzdWx0IH0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRFbmRpYW4obGl0dGxlRW5kaWFuOiBib29sZWFuLCBieXRlczogbnVtYmVyW10pOiBudW1iZXIge1xuICBsZXQgcmVzdWx0ID0gMDtcbiAgaWYgKCFsaXR0bGVFbmRpYW4pIGJ5dGVzLnJldmVyc2UoKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlcy5sZW5ndGg7IGkrKykge1xuICAgIHJlc3VsdCArPSAoYnl0ZXNbaV0gPDwgKGkgPDwgMykpID4+PiAwO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxudmFyIHRpbWVzdGFtcCA9IDA7XG52YXIgbGFzdFRpbWVPZmZzZXQgPSAwO1xuY29uc3QgQ29tcHJlc3NlZFRpbWVNYXNrID0gMzE7XG5jb25zdCBDb21wcmVzc2VkTG9jYWxNZXNnTnVtTWFzayA9IDB4NjA7XG5jb25zdCBDb21wcmVzc2VkSGVhZGVyTWFzayA9IDB4ODA7XG5jb25zdCBHYXJtaW5UaW1lT2Zmc2V0ID0gNjMxMDY1NjAwMDAwO1xubGV0IG1vbml0b3JpbmdfdGltZXN0YW1wID0gMDtcbiAgXG5mdW5jdGlvbiByZWFkRGF0YShibG9iOiBVaW50OEFycmF5LCBmRGVmOiBEZWYsIHN0YXJ0SW5kZXg6IG51bWJlcixcbiAgb3B0aW9uczogRml0UGFyc2VyT3B0aW9ucyk6IG51bWJlcnxudW1iZXJbXXxzdHJpbmcge1xuICBpZiAoZkRlZi5lbmRpYW5BYmlsaXR5ID09PSB0cnVlKSB7XG4gICAgY29uc3QgdGVtcCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZkRlZi5zaXplOyBpKyspIHtcbiAgICAgIHRlbXAucHVzaChibG9iW3N0YXJ0SW5kZXggKyBpXSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBidWZmZXIgfSA9IG5ldyBVaW50OEFycmF5KHRlbXApO1xuICAgIGNvbnN0IGRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7XG5cbiAgICB0cnkge1xuICAgICAgc3dpdGNoIChmRGVmLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnc2ludDE2JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0SW50MTYoMCwgZkRlZi5saXR0bGVFbmRpYW4pO1xuICAgICAgICBjYXNlICd1aW50MTYnOlxuICAgICAgICBjYXNlICd1aW50MTZ6JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0VWludDE2KDAsIGZEZWYubGl0dGxlRW5kaWFuKTtcbiAgICAgICAgY2FzZSAnc2ludDMyJzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0SW50MzIoMCwgZkRlZi5saXR0bGVFbmRpYW4pO1xuICAgICAgICBjYXNlICd1aW50MzInOlxuICAgICAgICBjYXNlICd1aW50MzJ6JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0VWludDMyKDAsIGZEZWYubGl0dGxlRW5kaWFuKTtcbiAgICAgICAgY2FzZSAnZmxvYXQzMic6XG4gICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldEZsb2F0MzIoMCwgZkRlZi5saXR0bGVFbmRpYW4pO1xuICAgICAgICBjYXNlICdmbG9hdDY0JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0RmxvYXQ2NCgwLCBmRGVmLmxpdHRsZUVuZGlhbik7XG4gICAgICAgIGNhc2UgJ3VpbnQzMl9hcnJheSc6XG4gICAgICAgICAgY29uc3QgYXJyYXkzMiA9IFtdO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZkRlZi5zaXplOyBpICs9IDQpIHtcbiAgICAgICAgICAgICAgYXJyYXkzMi5wdXNoKGRhdGFWaWV3LmdldFVpbnQzMihpLCBmRGVmLmxpdHRsZUVuZGlhbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gYXJyYXkzMjtcbiAgICAgICAgY2FzZSAndWludDE2X2FycmF5Jzoge1xuICAgICAgICAgIGNvbnN0IGFycmF5ID0gW107XG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmRGVmLnNpemU7IGkgKz0gMikge1xuICAgICAgICAgICAgYXJyYXkucHVzaChkYXRhVmlldy5nZXRVaW50MTYoaSwgZkRlZi5saXR0bGVFbmRpYW4pKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgRXJyb3IoJ05vIHR5cGUnKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBpZiAoIW9wdGlvbnMuZm9yY2UpIHtcbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYWRkRW5kaWFuKGZEZWYubGl0dGxlRW5kaWFuLCB0ZW1wKTtcbiAgfVxuXG4gIGlmIChmRGVmLnR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgY29uc3QgdGVtcCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZkRlZi5zaXplOyBpKyspIHtcbiAgICAgIGlmIChibG9iW3N0YXJ0SW5kZXggKyBpXSkge1xuICAgICAgICB0ZW1wLnB1c2goYmxvYltzdGFydEluZGV4ICsgaV0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gQnVmZmVyLmZyb20odGVtcCkudG9TdHJpbmcoJ3V0Zi04Jyk7XG4gIH1cblxuICBpZiAoZkRlZi50eXBlID09PSAnYnl0ZV9hcnJheScpIHtcbiAgICBjb25zdCB0ZW1wID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmRGVmLnNpemU7IGkrKykge1xuICAgICAgdGVtcC5wdXNoKGJsb2Jbc3RhcnRJbmRleCArIGldKTtcbiAgICB9XG4gICAgcmV0dXJuIHRlbXA7XG4gIH1cblxuICByZXR1cm4gYmxvYltzdGFydEluZGV4XTtcbn1cblxuZnVuY3Rpb24gZm9ybWF0QnlUeXBlKGRhdGE6IGFueSwgdHlwZT86IHN0cmluZyxcbiAgc2NhbGU/OiBudW1iZXJ8c3RyaW5nfG51bGwsIG9mZnNldD86IG51bWJlcnxzdHJpbmcpOiBhbnkge1xuICBjb25zdCBvZmYgPSBvZmZzZXQgP8Kgb2Zmc2V0IGFzIG51bWJlciA6IDA7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgJ2RhdGVfdGltZSc6XG4gICAgY2FzZSAnbG9jYWxfZGF0ZV90aW1lJzpcbiAgICAgIHJldHVybiBuZXcgRGF0ZSgoZGF0YSAqIDEwMDApICsgR2FybWluVGltZU9mZnNldCk7XG4gICAgY2FzZSAnc2ludDMyJzpcbiAgICAgIHJldHVybiBkYXRhICogRklUU0RLLnNjQ29uc3Q7XG4gICAgY2FzZSAndWludDgnOlxuICAgIGNhc2UgJ3NpbnQxNic6XG4gICAgY2FzZSAndWludDMyJzpcbiAgICBjYXNlICd1aW50MTYnOlxuICAgICAgcmV0dXJuIHNjYWxlID8gZGF0YSAvIChzY2FsZSBhcyBudW1iZXIpICsgb2ZmIDogZGF0YTtcbiAgICBjYXNlICd1aW50MzJfYXJyYXknOlxuICAgIGNhc2UgJ3VpbnQxNl9hcnJheSc6XG4gICAgICByZXR1cm4gZGF0YS5tYXAoKGRhdGFJdGVtOiBudW1iZXIpID0+IHtcbiAgICAgICAgaWYgKHNjYWxlKSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGFJdGVtIC8gKHNjYWxlIGFzIG51bWJlcikgKyBvZmY7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGFJdGVtO1xuICAgICAgfSk7XG4gICAgZGVmYXVsdDoge1xuICAgICAgaWYgKCF0eXBlKSB7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfVxuICAgICAgaWYgKCFGSVRTREsudHlwZXMuaGFzT3duUHJvcGVydHkodHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICB9XG4gICAgICBjb25zdCB0ID0gRklUU0RLLnR5cGVzW3R5cGVdXG4gICAgICBjb25zdCB0S2V5cyA9IE9iamVjdC5rZXlzKHQpXG4gICAgICAvLyBRdWljayBjaGVjayBmb3IgYSBtYXNrXG4gICAgICBjb25zdCB2YWx1ZXM6IChzdHJpbmd8bnVtYmVyKVtdID0gW107XG4gICAgICB0S2V5cy5mb3JFYWNoKChrZXk6IHN0cmluZykgPT4ge1xuICAgICAgICB2YWx1ZXMucHVzaCh0W3BhcnNlSW50KGtleSldKTtcbiAgICAgIH0pO1xuICAgICAgaWYgKHZhbHVlcy5pbmRleE9mKCdtYXNrJykgPT09IC0xKSB7XG4gICAgICAgIHJldHVybiB0W2RhdGFdO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YUl0ZW06IHsgW2tleTogc3RyaW5nXTogbnVtYmVyfGJvb2xlYW4gfSA9IHt9O1xuICAgICAgdEtleXMuZm9yRWFjaCgoa2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBjb25zdCBpdGVtID0gdFtwYXJzZUludChrZXkpXVxuICAgICAgICAgIGlmIChpdGVtID09PSAnbWFzaycpIHtcbiAgICAgICAgICAgIGRhdGFJdGVtWyd2YWx1ZSddID0gZGF0YSAmIHBhcnNlSW50KGtleSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRhdGFJdGVtW2l0ZW1dID0gISEoKGRhdGEgJiBwYXJzZUludChrZXkpKSA+PiA3KTtcbiAgICAgICAgICAgIC8vIE5vdCBzdXJlIGlmIHdlIG5lZWQgdGhlID4+IDcgYW5kIGNhc3RpbmcgdG8gYm9vbGVhbiBidXQgZnJvbSBhbGxcbiAgICAgICAgICAgIC8vIHRoZSBtYXNrZWQgcHJvcHMgb2YgZmllbGRzIHNvIGZhciB0aGlzIHNlZW1zIHRvIGJlIHRoZSBjYXNlXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIHJldHVybiBkYXRhSXRlbTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNJbnZhbGlkVmFsdWUoZGF0YTogYW55LCB0eXBlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSAnZW51bSc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHhGRjtcbiAgICBjYXNlICdzaW50OCc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHg3RjtcbiAgICBjYXNlICd1aW50OCc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHhGRjtcbiAgICBjYXNlICdzaW50MTYnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4N0ZGRjtcbiAgICBjYXNlICd1aW50MTYnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkZGRjtcbiAgICBjYXNlICdzaW50MzInOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4N0ZGRkZGRkY7XG4gICAgY2FzZSAndWludDMyJzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGRkZGRkZGO1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDtcbiAgICBjYXNlICdmbG9hdDMyJzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGRkZGRkZGO1xuICAgIGNhc2UgJ2Zsb2F0NjQnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkZGRkZGRkZGRkZGRkZGRjtcbiAgICBjYXNlICd1aW50OHonOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4MDA7XG4gICAgY2FzZSAndWludDE2eic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDAwO1xuICAgIGNhc2UgJ3VpbnQzMnonOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4MDAwMDAwO1xuICAgIGNhc2UgJ2J5dGUnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkY7XG4gICAgY2FzZSAnc2ludDY0JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweDdGRkZGRkZGRkZGRkZGRkY7XG4gICAgY2FzZSAndWludDY0JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGRkZGRkZGRkZGRkZGRkY7XG4gICAgY2FzZSAndWludDY0eic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDAwMDAwMDAwMDAwMDAwO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gY29udmVydFRvKGRhdGE6IGFueSwgdW5pdHNMaXN0OiBzdHJpbmcsIHNwZWVkVW5pdDogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgdW5pdE9iaiA9IEZJVFNESy5vcHRpb25zW3VuaXRzTGlzdF1bc3BlZWRVbml0XTtcbiAgcmV0dXJuIHVuaXRPYmogPyBkYXRhICogdW5pdE9iai5tdWx0aXBsaWVyICsgdW5pdE9iai5vZmZzZXQgOiBkYXRhO1xufVxuXG5mdW5jdGlvbiBhcHBseU9wdGlvbnMoZGF0YTogYW55LCBmaWVsZDogc3RyaW5nLCBvcHRpb25zOiBGaXRQYXJzZXJPcHRpb25zKTogYW55IHtcbiAgc3dpdGNoIChmaWVsZCkge1xuICAgIGNhc2UgJ3NwZWVkJzpcbiAgICBjYXNlICdlbmhhbmNlZF9zcGVlZCc6XG4gICAgY2FzZSAndmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ2F2Z19zcGVlZCc6XG4gICAgY2FzZSAnbWF4X3NwZWVkJzpcbiAgICBjYXNlICdzcGVlZF8xcyc6XG4gICAgY2FzZSAnYmFsbF9zcGVlZCc6XG4gICAgY2FzZSAnZW5oYW5jZWRfYXZnX3NwZWVkJzpcbiAgICBjYXNlICdlbmhhbmNlZF9tYXhfc3BlZWQnOlxuICAgIGNhc2UgJ2F2Z19wb3NfdmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ21heF9wb3NfdmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ2F2Z19uZWdfdmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ21heF9uZWdfdmVydGljYWxfc3BlZWQnOlxuICAgICAgLy8gISHCoGJlY2F1c2Ugb3B0aW9ucyBoYXZlIGFscmVhZHkgYmVlbiBjaGVja2VkXG4gICAgICByZXR1cm4gY29udmVydFRvKGRhdGEsICdzcGVlZFVuaXRzJywgb3B0aW9ucy5zcGVlZFVuaXQhISk7XG4gICAgY2FzZSAnZGlzdGFuY2UnOlxuICAgIGNhc2UgJ3RvdGFsX2Rpc3RhbmNlJzpcbiAgICBjYXNlICdlbmhhbmNlZF9hdmdfYWx0aXR1ZGUnOlxuICAgIGNhc2UgJ2VuaGFuY2VkX21pbl9hbHRpdHVkZSc6XG4gICAgY2FzZSAnZW5oYW5jZWRfbWF4X2FsdGl0dWRlJzpcbiAgICBjYXNlICdlbmhhbmNlZF9hbHRpdHVkZSc6XG4gICAgY2FzZSAnaGVpZ2h0JzpcbiAgICBjYXNlICdvZG9tZXRlcic6XG4gICAgY2FzZSAnYXZnX3N0cm9rZV9kaXN0YW5jZSc6XG4gICAgY2FzZSAnbWluX2FsdGl0dWRlJzpcbiAgICBjYXNlICdhdmdfYWx0aXR1ZGUnOlxuICAgIGNhc2UgJ21heF9hbHRpdHVkZSc6XG4gICAgY2FzZSAndG90YWxfYXNjZW50JzpcbiAgICBjYXNlICd0b3RhbF9kZXNjZW50JzpcbiAgICBjYXNlICdhbHRpdHVkZSc6XG4gICAgY2FzZSAnY3ljbGVfbGVuZ3RoJzpcbiAgICBjYXNlICdhdXRvX3doZWVsc2l6ZSc6XG4gICAgY2FzZSAnY3VzdG9tX3doZWVsc2l6ZSc6XG4gICAgY2FzZSAnZ3BzX2FjY3VyYWN5JzpcbiAgICAgIHJldHVybiBjb252ZXJ0VG8oZGF0YSwgJ2xlbmd0aFVuaXRzJywgb3B0aW9ucy5sZW5ndGhVbml0ISEpO1xuICAgIGNhc2UgJ3RlbXBlcmF0dXJlJzpcbiAgICBjYXNlICdhdmdfdGVtcGVyYXR1cmUnOlxuICAgIGNhc2UgJ21heF90ZW1wZXJhdHVyZSc6XG4gICAgICByZXR1cm4gY29udmVydFRvKGRhdGEsICd0ZW1wZXJhdHVyZVVuaXRzJywgb3B0aW9ucy50ZW1wZXJhdHVyZVVuaXQhISk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBkYXRhO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkUmVjb3JkKGJsb2I6IFVpbnQ4QXJyYXksIG1lc3NhZ2VUeXBlczogTWVzc2FnZVR5cGVzLFxuICBkZXZlbG9wZXJGaWVsZHM6IERldmVsb3BlckZpZWxkcyxcbiAgc3RhcnRJbmRleDogbnVtYmVyLCBvcHRpb25zOiBGaXRQYXJzZXJPcHRpb25zLFxuICBzdGFydERhdGU6IG51bWJlciwgcGF1c2VkVGltZTogbnVtYmVyKTogUmVhZFJlc3VsdCB7XG4gIGNvbnN0IHJlY29yZEhlYWRlciA9IGJsb2Jbc3RhcnRJbmRleF07XG4gIGxldCBsb2NhbE1lc3NhZ2VUeXBlID0gcmVjb3JkSGVhZGVyICYgMTU7XG5cbiAgaWYoKHJlY29yZEhlYWRlciAmIENvbXByZXNzZWRIZWFkZXJNYXNrKSA9PT0gQ29tcHJlc3NlZEhlYWRlck1hc2spe1xuICAgIC8vY29tcHJlc3NlZCB0aW1lc3RhbXBcblxuICAgIHZhciB0aW1lb2Zmc2V0ID0gcmVjb3JkSGVhZGVyICYgQ29tcHJlc3NlZFRpbWVNYXNrO1xuICAgIHRpbWVzdGFtcCArPSAoKHRpbWVvZmZzZXQgLSBsYXN0VGltZU9mZnNldCkgJiBDb21wcmVzc2VkVGltZU1hc2spO1xuICAgIGxhc3RUaW1lT2Zmc2V0ID0gdGltZW9mZnNldDtcblxuICAgIGxvY2FsTWVzc2FnZVR5cGUgPSAoKHJlY29yZEhlYWRlciAmIENvbXByZXNzZWRMb2NhbE1lc2dOdW1NYXNrKSA+PiA1KTtcbiAgfSBlbHNlIGlmICgocmVjb3JkSGVhZGVyICYgNjQpID09PSA2NCkge1xuICAgIC8vIGlzIGRlZmluaXRpb24gbWVzc2FnZVxuICAgIC8vIHN0YXJ0SW5kZXggKyAxIGlzIHJlc2VydmVkXG5cbiAgICBjb25zdCBoYXNEZXZlbG9wZXJEYXRhID0gKHJlY29yZEhlYWRlciAmIDMyKSA9PT0gMzI7XG4gICAgY29uc3QgbEVuZCA9IGJsb2Jbc3RhcnRJbmRleCArIDJdID09PSAwO1xuICAgIGNvbnN0IG51bWJlck9mRmllbGRzID0gYmxvYltzdGFydEluZGV4ICsgNV07XG4gICAgY29uc3QgbnVtYmVyT2ZEZXZlbG9wZXJEYXRhRmllbGRzID0gaGFzRGV2ZWxvcGVyRGF0YSA/IGJsb2Jbc3RhcnRJbmRleCArIDUgKyBudW1iZXJPZkZpZWxkcyAqIDMgKyAxXSA6IDA7XG5cbiAgICBjb25zdCBtVHlwZURlZjogVHlwZURlZiA9IHtcbiAgICAgIGxpdHRsZUVuZGlhbjogbEVuZCxcbiAgICAgIGdsb2JhbE1lc3NhZ2VOdW1iZXI6IGFkZEVuZGlhbihsRW5kLCBbYmxvYltzdGFydEluZGV4ICsgM10sIGJsb2Jbc3RhcnRJbmRleCArIDRdXSksXG4gICAgICBudW1iZXJPZkZpZWxkczogbnVtYmVyT2ZGaWVsZHMgKyBudW1iZXJPZkRldmVsb3BlckRhdGFGaWVsZHMsXG4gICAgICBmaWVsZERlZnM6IFtdLFxuICAgIH07XG5cbiAgICBjb25zdCBtZXNzYWdlID0gZ2V0Rml0TWVzc2FnZShtVHlwZURlZi5nbG9iYWxNZXNzYWdlTnVtYmVyKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZGaWVsZHM7IGkrKykge1xuICAgICAgY29uc3QgZkRlZkluZGV4ID0gc3RhcnRJbmRleCArIDYgKyAoaSAqIDMpO1xuICAgICAgY29uc3QgYmFzZVR5cGUgPSBibG9iW2ZEZWZJbmRleCArIDJdO1xuICAgICAgY29uc3QgeyBmaWVsZCwgdHlwZSB9ID0gbWVzc2FnZS5nZXRBdHRyaWJ1dGVzKGJsb2JbZkRlZkluZGV4XSk7IFxuICAgICAgY29uc3QgZkRlZjogRGVmID0ge1xuICAgICAgICB0eXBlLFxuICAgICAgICBmRGVmTm86IGJsb2JbZkRlZkluZGV4XSxcbiAgICAgICAgc2l6ZTogYmxvYltmRGVmSW5kZXggKyAxXSxcbiAgICAgICAgZW5kaWFuQWJpbGl0eTogKGJhc2VUeXBlICYgMTI4KSA9PT0gMTI4LFxuICAgICAgICBsaXR0bGVFbmRpYW46IGxFbmQsXG4gICAgICAgIGJhc2VUeXBlTm86IChiYXNlVHlwZSAmIDE1KSxcbiAgICAgICAgbmFtZTogZmllbGQsXG4gICAgICAgIGRhdGFUeXBlOiBnZXRGaXRNZXNzYWdlQmFzZVR5cGUoYmFzZVR5cGUgJiAxNSksXG4gICAgICB9O1xuXG4gICAgICBtVHlwZURlZi5maWVsZERlZnMucHVzaChmRGVmKTtcbiAgICB9XG5cbiAgICAvLyBudW1iZXJPZkRldmVsb3BlckRhdGFGaWVsZHMgPSAwIHNvIGl0IHdvbnQgY3Jhc2ggaGVyZSBhbmQgd29udCBsb29wXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkRldmVsb3BlckRhdGFGaWVsZHM7IGkrKykge1xuICAgICAgLy8gSWYgd2UgZmFpbCB0byBwYXJzZSB0aGVuIHRyeSBjYXRjaFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZkRlZkluZGV4ID0gc3RhcnRJbmRleCArIDYgKyAobnVtYmVyT2ZGaWVsZHMgKiAzKSArIDEgKyAoaSAqIDMpO1xuXG4gICAgICAgIGNvbnN0IGZpZWxkTnVtID0gYmxvYltmRGVmSW5kZXhdO1xuICAgICAgICBjb25zdCBzaXplID0gYmxvYltmRGVmSW5kZXggKyAxXTtcbiAgICAgICAgY29uc3QgZGV2RGF0YUluZGV4ID0gYmxvYltmRGVmSW5kZXggKyAyXTtcblxuICAgICAgICBjb25zdCBkZXZEZWYgPSBkZXZlbG9wZXJGaWVsZHNbZGV2RGF0YUluZGV4XVtmaWVsZE51bV07XG5cbiAgICAgICAgY29uc3QgYmFzZVR5cGUgPSBkZXZEZWYuZml0X2Jhc2VfdHlwZV9pZDtcblxuICAgICAgICBjb25zdCBmRGVmID0ge1xuICAgICAgICAgIHR5cGU6IEZJVFNESy50eXBlcy5maXRfYmFzZV90eXBlW2Jhc2VUeXBlXSxcbiAgICAgICAgICBzaXplLFxuICAgICAgICAgIGZEZWZObzogZmllbGROdW0sXG4gICAgICAgICAgZW5kaWFuQWJpbGl0eTogKGJhc2VUeXBlICYgMTI4KSA9PT0gMTI4LFxuICAgICAgICAgIGxpdHRsZUVuZGlhbjogbEVuZCxcbiAgICAgICAgICBiYXNlVHlwZU5vOiAoYmFzZVR5cGUgJiAxNSksXG4gICAgICAgICAgbmFtZTogZGV2RGVmLmZpZWxkX25hbWUsXG4gICAgICAgICAgZGF0YVR5cGU6IGdldEZpdE1lc3NhZ2VCYXNlVHlwZShiYXNlVHlwZSAmIDE1KSxcbiAgICAgICAgICBzY2FsZTogZGV2RGVmLnNjYWxlIHx8IDEsXG4gICAgICAgICAgb2Zmc2V0OiBkZXZEZWYub2Zmc2V0IHx8IDAsXG4gICAgICAgICAgZGV2ZWxvcGVyRGF0YUluZGV4OiBkZXZEYXRhSW5kZXgsXG4gICAgICAgICAgaXNEZXZlbG9wZXJGaWVsZDogdHJ1ZSxcbiAgICAgICAgfTtcblxuICAgICAgICBtVHlwZURlZi5maWVsZERlZnMucHVzaChmRGVmKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuZm9yY2UpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgIH1cblxuICAgIG1lc3NhZ2VUeXBlc1tsb2NhbE1lc3NhZ2VUeXBlXSA9IG1UeXBlRGVmO1xuXG4gICAgY29uc3QgbmV4dEluZGV4ID0gc3RhcnRJbmRleCArIDYgKyAobVR5cGVEZWYubnVtYmVyT2ZGaWVsZHMgKiAzKTtcbiAgICBjb25zdCBuZXh0SW5kZXhXaXRoRGV2ZWxvcGVyRGF0YSA9IG5leHRJbmRleCArIDE7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZVR5cGU6ICdkZWZpbml0aW9uJyxcbiAgICAgIG5leHRJbmRleDogaGFzRGV2ZWxvcGVyRGF0YSA/IG5leHRJbmRleFdpdGhEZXZlbG9wZXJEYXRhIDogbmV4dEluZGV4LFxuICAgIH07XG4gIH1cblxuICBjb25zdCBtZXNzYWdlVHlwZSA9IG1lc3NhZ2VUeXBlc1tsb2NhbE1lc3NhZ2VUeXBlXSB8fCBtZXNzYWdlVHlwZXNbMF07XG5cbiAgLy8gVE9ETzogaGFuZGxlIGNvbXByZXNzZWQgaGVhZGVyICgocmVjb3JkSGVhZGVyICYgMTI4KSA9PSAxMjgpXG5cbiAgLy8gdW5jb21wcmVzc2VkIGhlYWRlclxuICBsZXQgbWVzc2FnZVNpemUgPSAwO1xuICBsZXQgcmVhZERhdGFGcm9tSW5kZXggPSBzdGFydEluZGV4ICsgMTtcbiAgY29uc3QgZmllbGRzOiBGaWVsZHMgPSB7fTtcblxuICBjb25zdCBtZXNzYWdlID0gZ2V0Rml0TWVzc2FnZShtZXNzYWdlVHlwZS5nbG9iYWxNZXNzYWdlTnVtYmVyKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IG1lc3NhZ2VUeXBlLmZpZWxkRGVmcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGZEZWYgPSBtZXNzYWdlVHlwZS5maWVsZERlZnNbaV07XG4gICAgY29uc3QgZGF0YSA9IHJlYWREYXRhKGJsb2IsIGZEZWYsIHJlYWREYXRhRnJvbUluZGV4LCBvcHRpb25zKTtcblxuICAgIGlmICghaXNJbnZhbGlkVmFsdWUoZGF0YSwgZkRlZi50eXBlKSkge1xuICAgICAgaWYgKGZEZWYuaXNEZXZlbG9wZXJGaWVsZCAmJiBmRGVmLm5hbWUpIHtcbiAgICAgICAgY29uc3QgZmllbGQgPSBmRGVmLm5hbWU7XG4gICAgICAgIGNvbnN0IHsgdHlwZSwgc2NhbGUsIG9mZnNldCB9ID0gZkRlZjtcblxuICAgICAgICBmaWVsZHNbZkRlZi5uYW1lXSA9IGFwcGx5T3B0aW9ucyhmb3JtYXRCeVR5cGUoZGF0YSwgdHlwZSwgc2NhbGUsIG9mZnNldCksIGZpZWxkLCBvcHRpb25zKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHsgZmllbGQsIHR5cGUsIHNjYWxlLCBvZmZzZXQgfSA9IG1lc3NhZ2UuZ2V0QXR0cmlidXRlcyhmRGVmLmZEZWZObyk7XG5cbiAgICAgICAgaWYgKGZpZWxkICE9PSAndW5rbm93bicgJiYgZmllbGQgIT09ICcnICYmIGZpZWxkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBmaWVsZHNbZmllbGRdID0gYXBwbHlPcHRpb25zKGZvcm1hdEJ5VHlwZShkYXRhLCB0eXBlLCBzY2FsZSwgb2Zmc2V0KSwgZmllbGQsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChtZXNzYWdlLm5hbWUgPT09ICdyZWNvcmQnICYmIG9wdGlvbnMuZWxhcHNlZFJlY29yZEZpZWxkICYmXG4gICAgICAgICAgZmllbGRzLnRpbWVzdGFtcCkge1xuICAgICAgICBmaWVsZHMuZWxhcHNlZF90aW1lID0gKGZpZWxkcy50aW1lc3RhbXAgLSBzdGFydERhdGUpIC8gMTAwMDtcbiAgICAgICAgZmllbGRzLnRpbWVyX3RpbWUgPSBmaWVsZHMuZWxhcHNlZF90aW1lIC0gcGF1c2VkVGltZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZWFkRGF0YUZyb21JbmRleCArPSBmRGVmLnNpemU7XG4gICAgbWVzc2FnZVNpemUgKz0gZkRlZi5zaXplO1xuICB9XG5cbiAgaWYgKG1lc3NhZ2UubmFtZSA9PT0gJ2ZpZWxkX2Rlc2NyaXB0aW9uJykge1xuICAgIGlmIChmaWVsZHMuZmllbGRfZGVmaW5pdGlvbl9udW1iZXIgJiZcbiAgICAgICAgZmllbGRzLmRldmVsb3Blcl9kYXRhX2luZGV4KSB7XG4gICAgICBkZXZlbG9wZXJGaWVsZHNbZmllbGRzLmRldmVsb3Blcl9kYXRhX2luZGV4XSA9XG4gICAgICAgIGRldmVsb3BlckZpZWxkc1tmaWVsZHMuZGV2ZWxvcGVyX2RhdGFfaW5kZXhdIHx8IFtdO1xuICAgICAgZGV2ZWxvcGVyRmllbGRzW2ZpZWxkcy5kZXZlbG9wZXJfZGF0YV9pbmRleF1bZmllbGRzLmZpZWxkX2RlZmluaXRpb25fbnVtYmVyXSA9IGZpZWxkcztcbiAgICB9XG4gIH1cblxuICBpZiAobWVzc2FnZS5uYW1lID09PSAnbW9uaXRvcmluZycpIHtcbiAgICAvL3dlIG5lZWQgdG8ga2VlcCB0aGUgcmF3IHRpbWVzdGFtcCB2YWx1ZSBzbyB3ZSBjYW4gY2FsY3VsYXRlIHN1YnNlcXVlbnQgdGltZXN0YW1wMTYgZmllbGRzXG4gICAgaWYoZmllbGRzLnRpbWVzdGFtcCl7XG4gICAgICAgIG1vbml0b3JpbmdfdGltZXN0YW1wID0gZmllbGRzLnRpbWVzdGFtcDtcbiAgICAgICAgZmllbGRzLnRpbWVzdGFtcCA9IG5ldyBEYXRlKGZpZWxkcy50aW1lc3RhbXAgKiAxMDAwICsgR2FybWluVGltZU9mZnNldCkuZ2V0VGltZSgpO1xuICAgIH1cbiAgICBpZihmaWVsZHMudGltZXN0YW1wMTYgJiYgIWZpZWxkcy50aW1lc3RhbXApe1xuICAgICAgICBtb25pdG9yaW5nX3RpbWVzdGFtcCArPSAoIGZpZWxkcy50aW1lc3RhbXAxNiAtICggbW9uaXRvcmluZ190aW1lc3RhbXAgJiAweEZGRkYgKSApICYgMHhGRkZGO1xuICAgICAgICAvL2ZpZWxkcy50aW1lc3RhbXAgPSBtb25pdG9yaW5nX3RpbWVzdGFtcDtcbiAgICAgICAgZmllbGRzLnRpbWVzdGFtcCA9IG5ldyBEYXRlKG1vbml0b3JpbmdfdGltZXN0YW1wICogMTAwMCArIEdhcm1pblRpbWVPZmZzZXQpLmdldFRpbWUoKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCByZXN1bHQgPSB7XG4gICAgbWVzc2FnZVR5cGU6IG1lc3NhZ2UubmFtZSxcbiAgICBuZXh0SW5kZXg6IHN0YXJ0SW5kZXggKyBtZXNzYWdlU2l6ZSArIDEsXG4gICAgbWVzc2FnZTogZmllbGRzLFxuICB9O1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcnJheUJ1ZmZlcihidWZmZXI6IEFycmF5QnVmZmVyfEJ1ZmZlcikge1xuICBpZiAoYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHtcbiAgICByZXR1cm4gYnVmZmVyO1xuICB9XG4gIGNvbnN0IGFiID0gbmV3IEFycmF5QnVmZmVyKGJ1ZmZlci5sZW5ndGgpO1xuICBjb25zdCB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYWIpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1ZmZlci5sZW5ndGg7ICsraSkge1xuICAgIHZpZXdbaV0gPSBidWZmZXJbaV07XG4gIH1cbiAgcmV0dXJuIGFiO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQ1JDKGJsb2I6IFVpbnQ4QXJyYXksIHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKSB7XG4gIGNvbnN0IGNyY1RhYmxlID0gW1xuICAgIDB4MDAwMCwgMHhDQzAxLCAweEQ4MDEsIDB4MTQwMCwgMHhGMDAxLCAweDNDMDAsIDB4MjgwMCwgMHhFNDAxLFxuICAgIDB4QTAwMSwgMHg2QzAwLCAweDc4MDAsIDB4QjQwMSwgMHg1MDAwLCAweDlDMDEsIDB4ODgwMSwgMHg0NDAwLFxuICBdO1xuXG4gIGxldCBjcmMgPSAwO1xuICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgIGNvbnN0IGJ5dGUgPSBibG9iW2ldO1xuICAgIGxldCB0bXAgPSBjcmNUYWJsZVtjcmMgJiAweEZdO1xuICAgIGNyYyA9IChjcmMgPj4gNCkgJiAweDBGRkY7XG4gICAgY3JjID0gY3JjIF4gdG1wIF4gY3JjVGFibGVbYnl0ZSAmIDB4Rl07XG4gICAgdG1wID0gY3JjVGFibGVbY3JjICYgMHhGXTtcbiAgICBjcmMgPSAoY3JjID4+IDQpICYgMHgwRkZGO1xuICAgIGNyYyA9IGNyYyBeIHRtcCBeIGNyY1RhYmxlWyhieXRlID4+IDQpICYgMHhGXTtcbiAgfVxuXG4gIHJldHVybiBjcmM7XG59XG4iXX0=