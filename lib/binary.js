"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.addEndian = addEndian;
exports.readRecord = readRecord;
exports.getArrayBuffer = getArrayBuffer;
exports.calculateCRC = calculateCRC;

var _sdk = require("./sdk");

var _messages = require("./messages");

function addEndian(littleEndian, bytes) {
  var result = 0;
  if (!littleEndian) bytes.reverse();

  for (var i = 0; i < bytes.length; i++) {
    result += bytes[i] << (i << 3) >>> 0;
  }

  return result;
}

function readData(blob, fDef, startIndex, options) {
  if (fDef.endianAbility === true) {
    var temp = [];

    for (var i = 0; i < fDef.size; i++) {
      temp.push(blob[startIndex + i]);
    }

    var _ref = new Uint8Array(temp),
        buffer = _ref.buffer;

    var dataView = new DataView(buffer);

    try {
      switch (fDef.type) {
        case 'sint16':
          return dataView.getInt16(0, fDef.littleEndian);

        case 'uint16':
        case 'uint16z':
          return dataView.getUint16(0, fDef.littleEndian);

        case 'sint32':
          return dataView.getInt32(0, fDef.littleEndian);

        case 'uint32':
        case 'uint32z':
          return dataView.getUint32(0, fDef.littleEndian);

        case 'float32':
          return dataView.getFloat32(0, fDef.littleEndian);

        case 'float64':
          return dataView.getFloat64(0, fDef.littleEndian);

        case 'uint16_array':
          {
            var array = [];

            for (var _i = 0; _i < fDef.size; _i += 2) {
              array.push(dataView.getUint16(_i, fDef.littleEndian));
            }

            return array;
          }

        default:
          throw Error('No type');
      }
    } catch (e) {
      if (!options.force) {
        throw e;
      }
    }

    return addEndian(fDef.littleEndian, temp);
  }

  if (fDef.type === 'string') {
    var _temp = [];

    for (var _i2 = 0; _i2 < fDef.size; _i2++) {
      if (blob[startIndex + _i2]) {
        _temp.push(blob[startIndex + _i2]);
      }
    }

    return Buffer.from(_temp).toString('utf-8');
  }

  if (fDef.type === 'byte_array') {
    var _temp2 = [];

    for (var _i3 = 0; _i3 < fDef.size; _i3++) {
      _temp2.push(blob[startIndex + _i3]);
    }

    return _temp2;
  }

  return blob[startIndex];
}

function formatByType(data, type, scale, offset) {
  switch (type) {
    case 'date_time':
    case 'local_date_time':
      return new Date(data * 1000 + 631065600000);

    case 'sint32':
      return data * _sdk.FITSDK.scConst;

    case 'sint16':
    case 'uint32':
    case 'uint16':
      return scale ? data / scale + (offset || 0) : data;

    case 'uint16_array':
      var data_array = data;
      return data.map(function (dataItem) {
        if (scale) {
          return dataItem / scale + (offset || 0);
        }

        return dataItem;
      });

    default:
      {
        if (!_sdk.FITSDK.types.hasOwnProperty(type)) {
          return data;
        }

        var t = _sdk.FITSDK.types[type];
        var tKeys = Object.keys(t); // Quick check for a mask

        var values = [];
        tKeys.forEach(function (key) {
          values.push(t[parseInt(key)]);
        });

        if (values.indexOf('mask') === -1) {
          return t[data];
        }

        var dataItem = {};
        tKeys.forEach(function (key) {
          var item = t[parseInt(key)];

          if (item === 'mask') {
            dataItem['value'] = data & parseInt(key);
          } else {
            dataItem[item] = !!((data & parseInt(key)) >> 7); // Not sure if we need the >> 7 and casting to boolean but from all
            // the masked props of fields so far this seems to be the case
          }
        });
        return dataItem;
      }
  }
}

function isInvalidValue(data, type) {
  switch (type) {
    case 'enum':
      return data === 0xFF;

    case 'sint8':
      return data === 0x7F;

    case 'uint8':
      return data === 0xFF;

    case 'sint16':
      return data === 0x7FFF;

    case 'uint16':
      return data === 0xFFFF;

    case 'sint32':
      return data === 0x7FFFFFFF;

    case 'uint32':
      return data === 0xFFFFFFFF;

    case 'string':
      return data === 0x00;

    case 'float32':
      return data === 0xFFFFFFFF;

    case 'float64':
      return data === 0xFFFFFFFFFFFFFFFF;

    case 'uint8z':
      return data === 0x00;

    case 'uint16z':
      return data === 0x0000;

    case 'uint32z':
      return data === 0x000000;

    case 'byte':
      return data === 0xFF;

    case 'sint64':
      return data === 0x7FFFFFFFFFFFFFFF;

    case 'uint64':
      return data === 0xFFFFFFFFFFFFFFFF;

    case 'uint64z':
      return data === 0x0000000000000000;

    default:
      return false;
  }
}

function convertTo(data, unitsList, speedUnit) {
  var unitObj = _sdk.FITSDK.options[unitsList][speedUnit];
  return unitObj ? data * unitObj.multiplier + unitObj.offset : data;
}

function applyOptions(data, field, options) {
  switch (field) {
    case 'speed':
    case 'enhanced_speed':
    case 'vertical_speed':
    case 'avg_speed':
    case 'max_speed':
    case 'speed_1s':
    case 'ball_speed':
    case 'enhanced_avg_speed':
    case 'enhanced_max_speed':
    case 'avg_pos_vertical_speed':
    case 'max_pos_vertical_speed':
    case 'avg_neg_vertical_speed':
    case 'max_neg_vertical_speed':
      if (options.speedUnit) {
        return convertTo(data, 'speedUnits', options.speedUnit);
      }

    case 'distance':
    case 'total_distance':
    case 'enhanced_avg_altitude':
    case 'enhanced_min_altitude':
    case 'enhanced_max_altitude':
    case 'enhanced_altitude':
    case 'height':
    case 'odometer':
    case 'avg_stroke_distance':
    case 'min_altitude':
    case 'avg_altitude':
    case 'max_altitude':
    case 'total_ascent':
    case 'total_descent':
    case 'altitude':
    case 'cycle_length':
    case 'auto_wheelsize':
    case 'custom_wheelsize':
    case 'gps_accuracy':
      if (options.lengthUnit) {
        return convertTo(data, 'lengthUnits', options.lengthUnit);
      }

    case 'temperature':
    case 'avg_temperature':
    case 'max_temperature':
      if (options.temperatureUnit) {
        return convertTo(data, 'temperatureUnits', options.temperatureUnit);
      }

    default:
      return data;
  }
}

function readRecord(blob, messageTypes, developerFields, startIndex, options, startDate, pausedTime) {
  var recordHeader = blob[startIndex];
  var localMessageType = recordHeader & 15;

  if ((recordHeader & 64) === 64) {
    // is definition message
    // startIndex + 1 is reserved
    var hasDeveloperData = (recordHeader & 32) === 32;
    var lEnd = blob[startIndex + 2] === 0;
    var numberOfFields = blob[startIndex + 5];
    var numberOfDeveloperDataFields = hasDeveloperData ? blob[startIndex + 5 + numberOfFields * 3 + 1] : 0;
    var mTypeDef = {
      littleEndian: lEnd,
      globalMessageNumber: addEndian(lEnd, [blob[startIndex + 3], blob[startIndex + 4]]),
      numberOfFields: numberOfFields + numberOfDeveloperDataFields,
      fieldDefs: []
    };

    var _message = (0, _messages.getFitMessage)(mTypeDef.globalMessageNumber);

    console.log(_message);

    for (var i = 0; i < numberOfFields; i++) {
      var fDefIndex = startIndex + 6 + i * 3;
      var baseType = blob[fDefIndex + 2];

      var _message$getAttribute = _message.getAttributes(blob[fDefIndex]),
          field = _message$getAttribute.field,
          type = _message$getAttribute.type;

      if (field) {
        var fDef = {
          type: type,
          fDefNo: blob[fDefIndex],
          size: blob[fDefIndex + 1],
          endianAbility: (baseType & 128) === 128,
          littleEndian: lEnd,
          baseTypeNo: baseType & 15,
          name: field,
          dataType: (0, _messages.getFitMessageBaseType)(baseType & 15)
        };
        mTypeDef.fieldDefs.push(fDef);
      }
    }

    for (var _i4 = 0; _i4 < numberOfDeveloperDataFields; _i4++) {
      // If we fail to parse then try catch
      try {
        var _fDefIndex = startIndex + 6 + numberOfFields * 3 + 1 + _i4 * 3;

        var fieldNum = blob[_fDefIndex];
        var size = blob[_fDefIndex + 1];
        var devDataIndex = blob[_fDefIndex + 2];
        var devDef = developerFields[devDataIndex][fieldNum];
        var _baseType = devDef.fit_base_type_id;
        var _fDef = {
          type: _sdk.FITSDK.types.fit_base_type[_baseType],
          size: size,
          fDefNo: fieldNum,
          endianAbility: (_baseType & 128) === 128,
          littleEndian: lEnd,
          baseTypeNo: _baseType & 15,
          name: devDef.field_name,
          dataType: (0, _messages.getFitMessageBaseType)(_baseType & 15),
          scale: devDef.scale || 1,
          offset: devDef.offset || 0,
          developerDataIndex: devDataIndex,
          isDeveloperField: true
        };
        mTypeDef.fieldDefs.push(_fDef);
      } catch (e) {
        if (options.force) {
          continue;
        }

        throw e;
      }
    }

    messageTypes[localMessageType] = mTypeDef;
    var nextIndex = startIndex + 6 + mTypeDef.numberOfFields * 3;
    var nextIndexWithDeveloperData = nextIndex + 1;
    return {
      messageType: 'definition',
      nextIndex: hasDeveloperData ? nextIndexWithDeveloperData : nextIndex
    };
  }

  var messageType = messageTypes[localMessageType] || messageTypes[0]; // TODO: handle compressed header ((recordHeader & 128) == 128)
  // uncompressed header

  var messageSize = 0;
  var readDataFromIndex = startIndex + 1;
  var fields = {};
  var message = (0, _messages.getFitMessage)(messageType.globalMessageNumber);

  for (var _i5 = 0; _i5 < messageType.fieldDefs.length; _i5++) {
    var _fDef2 = messageType.fieldDefs[_i5];
    var data = readData(blob, _fDef2, readDataFromIndex, options);

    if (!isInvalidValue(data, _fDef2.type)) {
      if (_fDef2.isDeveloperField) {
        var field = _fDef2.name;
        var type = _fDef2.type,
            scale = _fDef2.scale,
            offset = _fDef2.offset;

        if (type) {
          fields[_fDef2.name] = applyOptions(formatByType(data, type, scale, offset), field, options);
        }
      } else {
        var _message$getAttribute2 = message.getAttributes(_fDef2.fDefNo),
            _field = _message$getAttribute2.field,
            _type = _message$getAttribute2.type,
            _scale = _message$getAttribute2.scale,
            _offset = _message$getAttribute2.offset;

        if (_field !== 'unknown' && _field !== '' && _field !== undefined && _type) {
          fields[_field] = applyOptions(formatByType(data, _type, _scale, _offset), _field, options);
        }
      }

      if (message.name === 'record' && options.elapsedRecordField && fields.timestamp) {
        fields.elapsed_time = (fields.timestamp - startDate) / 1000;
        fields.timer_time = fields.elapsed_time - pausedTime;
      }
    }

    readDataFromIndex += _fDef2.size;
    messageSize += _fDef2.size;
  }

  if (message.name === 'field_description') {
    if (fields.developer_data_index && fields.field_definition_number) {
      developerFields[fields.developer_data_index] = developerFields[fields.developer_data_index] || [];
      developerFields[fields.developer_data_index][fields.field_definition_number] = fields;
    }
  }

  var result = {
    messageType: message.name,
    nextIndex: startIndex + messageSize + 1,
    message: fields
  };
  return result;
}

function getArrayBuffer(buffer) {
  if (buffer instanceof ArrayBuffer) {
    return buffer;
  }

  var ab = new ArrayBuffer(buffer.length);
  var view = new Uint8Array(ab);

  for (var i = 0; i < buffer.length; ++i) {
    view[i] = buffer[i];
  }

  return ab;
}

function calculateCRC(blob, start, end) {
  var crcTable = [0x0000, 0xCC01, 0xD801, 0x1400, 0xF001, 0x3C00, 0x2800, 0xE401, 0xA001, 0x6C00, 0x7800, 0xB401, 0x5000, 0x9C01, 0x8801, 0x4400];
  var crc = 0;

  for (var i = start; i < end; i++) {
    var _byte = blob[i];
    var tmp = crcTable[crc & 0xF];
    crc = crc >> 4 & 0x0FFF;
    crc = crc ^ tmp ^ crcTable[_byte & 0xF];
    tmp = crcTable[crc & 0xF];
    crc = crc >> 4 & 0x0FFF;
    crc = crc ^ tmp ^ crcTable[_byte >> 4 & 0xF];
  }

  return crc;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9iaW5hcnkudHMiXSwibmFtZXMiOlsiYWRkRW5kaWFuIiwibGl0dGxlRW5kaWFuIiwiYnl0ZXMiLCJyZXN1bHQiLCJyZXZlcnNlIiwiaSIsImxlbmd0aCIsInJlYWREYXRhIiwiYmxvYiIsImZEZWYiLCJzdGFydEluZGV4Iiwib3B0aW9ucyIsImVuZGlhbkFiaWxpdHkiLCJ0ZW1wIiwic2l6ZSIsInB1c2giLCJVaW50OEFycmF5IiwiYnVmZmVyIiwiZGF0YVZpZXciLCJEYXRhVmlldyIsInR5cGUiLCJnZXRJbnQxNiIsImdldFVpbnQxNiIsImdldEludDMyIiwiZ2V0VWludDMyIiwiZ2V0RmxvYXQzMiIsImdldEZsb2F0NjQiLCJhcnJheSIsIkVycm9yIiwiZSIsImZvcmNlIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiZm9ybWF0QnlUeXBlIiwiZGF0YSIsInNjYWxlIiwib2Zmc2V0IiwiRGF0ZSIsIkZJVFNESyIsInNjQ29uc3QiLCJkYXRhX2FycmF5IiwibWFwIiwiZGF0YUl0ZW0iLCJ0eXBlcyIsImhhc093blByb3BlcnR5IiwidCIsInRLZXlzIiwiT2JqZWN0Iiwia2V5cyIsInZhbHVlcyIsImZvckVhY2giLCJrZXkiLCJwYXJzZUludCIsImluZGV4T2YiLCJpdGVtIiwiaXNJbnZhbGlkVmFsdWUiLCJjb252ZXJ0VG8iLCJ1bml0c0xpc3QiLCJzcGVlZFVuaXQiLCJ1bml0T2JqIiwibXVsdGlwbGllciIsImFwcGx5T3B0aW9ucyIsImZpZWxkIiwibGVuZ3RoVW5pdCIsInRlbXBlcmF0dXJlVW5pdCIsInJlYWRSZWNvcmQiLCJtZXNzYWdlVHlwZXMiLCJkZXZlbG9wZXJGaWVsZHMiLCJzdGFydERhdGUiLCJwYXVzZWRUaW1lIiwicmVjb3JkSGVhZGVyIiwibG9jYWxNZXNzYWdlVHlwZSIsImhhc0RldmVsb3BlckRhdGEiLCJsRW5kIiwibnVtYmVyT2ZGaWVsZHMiLCJudW1iZXJPZkRldmVsb3BlckRhdGFGaWVsZHMiLCJtVHlwZURlZiIsImdsb2JhbE1lc3NhZ2VOdW1iZXIiLCJmaWVsZERlZnMiLCJtZXNzYWdlIiwiY29uc29sZSIsImxvZyIsImZEZWZJbmRleCIsImJhc2VUeXBlIiwiZ2V0QXR0cmlidXRlcyIsImZEZWZObyIsImJhc2VUeXBlTm8iLCJuYW1lIiwiZGF0YVR5cGUiLCJmaWVsZE51bSIsImRldkRhdGFJbmRleCIsImRldkRlZiIsImZpdF9iYXNlX3R5cGVfaWQiLCJmaXRfYmFzZV90eXBlIiwiZmllbGRfbmFtZSIsImRldmVsb3BlckRhdGFJbmRleCIsImlzRGV2ZWxvcGVyRmllbGQiLCJuZXh0SW5kZXgiLCJuZXh0SW5kZXhXaXRoRGV2ZWxvcGVyRGF0YSIsIm1lc3NhZ2VUeXBlIiwibWVzc2FnZVNpemUiLCJyZWFkRGF0YUZyb21JbmRleCIsImZpZWxkcyIsInVuZGVmaW5lZCIsImVsYXBzZWRSZWNvcmRGaWVsZCIsInRpbWVzdGFtcCIsImVsYXBzZWRfdGltZSIsInRpbWVyX3RpbWUiLCJkZXZlbG9wZXJfZGF0YV9pbmRleCIsImZpZWxkX2RlZmluaXRpb25fbnVtYmVyIiwiZ2V0QXJyYXlCdWZmZXIiLCJBcnJheUJ1ZmZlciIsImFiIiwidmlldyIsImNhbGN1bGF0ZUNSQyIsInN0YXJ0IiwiZW5kIiwiY3JjVGFibGUiLCJjcmMiLCJieXRlIiwidG1wIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBSU8sU0FBU0EsU0FBVCxDQUFtQkMsWUFBbkIsRUFBMENDLEtBQTFDLEVBQW1FO0FBQ3hFLE1BQUlDLE1BQU0sR0FBRyxDQUFiO0FBQ0EsTUFBSSxDQUFDRixZQUFMLEVBQW1CQyxLQUFLLENBQUNFLE9BQU47O0FBQ25CLE9BQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gsS0FBSyxDQUFDSSxNQUExQixFQUFrQ0QsQ0FBQyxFQUFuQyxFQUF1QztBQUNyQ0YsSUFBQUEsTUFBTSxJQUFLRCxLQUFLLENBQUNHLENBQUQsQ0FBTCxLQUFhQSxDQUFDLElBQUksQ0FBbEIs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QUVTLE1BRlQsRUFFaUIsTUFGakIsRUFFeUIsTUFGekIsRUFFaUMsTUFGakMsRUFFeUMsTUFGekMsQ0FBakI7QUFLQSxNQUFJQyxHQUFHLEdBQUcsQ0FBVjs7QUFDQSxPQUFLLElBQUlsSCxDQUFDLEdBQUcrRyxLQUFiLEVBQW9CL0csQ0FBQyxHQUFHZ0gsR0FBeEIsRUFBNkJoSCxDQUFDLEVBQTlCLEVBQWtDO0FBQ2hDLFFBQU1tSCxLQUFJLEdBQUdoSCxJQUFJLENBQUNILENBQUQsQ0FBakI7QUFDQSxRQUFJb0gsR0FBRyxHQUFHSCxRQUFRLENBQUNDLEdBQUcsR0FBRyxHQUFQLENBQWxCO0FBQ0FBLElBQUFBLEdBQUcsR0FBSUEsR0FBRyxJQUFJLENBQVIsR0FBYSxNQUFuQjtBQUNBQSxJQUFBQSxHQUFHLEdBQUdBLEdBQUcsR0FBR0UsR0FBTixHQUFZSCxRQUFRLENBQUNFLEtBQUksR0FBRyxHQUFSLENBQTFCO0FBQ0FDLElBQUFBLEdBQUcsR0FBR0gsUUFBUSxDQUFDQyxHQUFHLEdBQUcsR0FBUCxDQUFkO0FBQ0FBLElBQUFBLEdBQUcsR0FBSUEsR0FBRyxJQUFJLENBQVIsR0FBYSxNQUFuQjtBQUNBQSxJQUFBQSxHQUFHLEdBQUdBLEdBQUcsR0FBR0UsR0FBTixHQUFZSCxRQUFRLENBQUVFLEtBQUksSUFBSSxDQUFULEdBQWMsR0FBZixDQUExQjtBQUNEOztBQUVELFNBQU9ELEdBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZJVFNESyB9IGZyb20gJy4vc2RrJztcbmltcG9ydCB7IGdldEZpdE1lc3NhZ2UsIGdldEZpdE1lc3NhZ2VCYXNlVHlwZSB9IGZyb20gJy4vbWVzc2FnZXMnO1xuaW1wb3J0IHsgVHlwZURlZiwgRGVmLCBNZXNzYWdlLCBGaWVsZHMsIE1lc3NhZ2VUeXBlcyxcbiAgRGV2ZWxvcGVyRmllbGRzLCBGaXRQYXJzZXJPcHRpb25zLCBSZWFkUmVzdWx0IH0gZnJvbSAnLi90eXBlcyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRFbmRpYW4obGl0dGxlRW5kaWFuOiBib29sZWFuLCBieXRlczogbnVtYmVyW10pOiBudW1iZXIge1xuICBsZXQgcmVzdWx0ID0gMDtcbiAgaWYgKCFsaXR0bGVFbmRpYW4pIGJ5dGVzLnJldmVyc2UoKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBieXRlcy5sZW5ndGg7IGkrKykge1xuICAgIHJlc3VsdCArPSAoYnl0ZXNbaV0gPDwgKGkgPDwgMykpID4+PiAwO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cbiAgXG5mdW5jdGlvbiByZWFkRGF0YShibG9iOiBVaW50OEFycmF5LCBmRGVmOiBEZWYsIHN0YXJ0SW5kZXg6IG51bWJlcixcbiAgb3B0aW9uczogRml0UGFyc2VyT3B0aW9ucyk6IG51bWJlcnxudW1iZXJbXXxzdHJpbmcge1xuICBpZiAoZkRlZi5lbmRpYW5BYmlsaXR5ID09PSB0cnVlKSB7XG4gICAgY29uc3QgdGVtcCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZkRlZi5zaXplOyBpKyspIHtcbiAgICAgIHRlbXAucHVzaChibG9iW3N0YXJ0SW5kZXggKyBpXSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBidWZmZXIgfSA9IG5ldyBVaW50OEFycmF5KHRlbXApO1xuICAgIGNvbnN0IGRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7XG5cbiAgICB0cnkge1xuICAgICAgc3dpdGNoIChmRGVmLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnc2ludDE2JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0SW50MTYoMCwgZkRlZi5saXR0bGVFbmRpYW4pO1xuICAgICAgICBjYXNlICd1aW50MTYnOlxuICAgICAgICBjYXNlICd1aW50MTZ6JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0VWludDE2KDAsIGZEZWYubGl0dGxlRW5kaWFuKTtcbiAgICAgICAgY2FzZSAnc2ludDMyJzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0SW50MzIoMCwgZkRlZi5saXR0bGVFbmRpYW4pO1xuICAgICAgICBjYXNlICd1aW50MzInOlxuICAgICAgICBjYXNlICd1aW50MzJ6JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0VWludDMyKDAsIGZEZWYubGl0dGxlRW5kaWFuKTtcbiAgICAgICAgY2FzZSAnZmxvYXQzMic6XG4gICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldEZsb2F0MzIoMCwgZkRlZi5saXR0bGVFbmRpYW4pO1xuICAgICAgICBjYXNlICdmbG9hdDY0JzpcbiAgICAgICAgICByZXR1cm4gZGF0YVZpZXcuZ2V0RmxvYXQ2NCgwLCBmRGVmLmxpdHRsZUVuZGlhbik7XG4gICAgICAgIGNhc2UgJ3VpbnQxNl9hcnJheSc6IHtcbiAgICAgICAgICBjb25zdCBhcnJheSA9IFtdO1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZkRlZi5zaXplOyBpICs9IDIpIHtcbiAgICAgICAgICAgIGFycmF5LnB1c2goZGF0YVZpZXcuZ2V0VWludDE2KGksIGZEZWYubGl0dGxlRW5kaWFuKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBhcnJheTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IEVycm9yKCdObyB0eXBlJyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKCFvcHRpb25zLmZvcmNlKSB7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGFkZEVuZGlhbihmRGVmLmxpdHRsZUVuZGlhbiwgdGVtcCk7XG4gIH1cblxuICBpZiAoZkRlZi50eXBlID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IHRlbXAgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZEZWYuc2l6ZTsgaSsrKSB7XG4gICAgICBpZiAoYmxvYltzdGFydEluZGV4ICsgaV0pIHtcbiAgICAgICAgdGVtcC5wdXNoKGJsb2Jbc3RhcnRJbmRleCArIGldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKHRlbXApLnRvU3RyaW5nKCd1dGYtOCcpO1xuICB9XG5cbiAgaWYgKGZEZWYudHlwZSA9PT0gJ2J5dGVfYXJyYXknKSB7XG4gICAgY29uc3QgdGVtcCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZkRlZi5zaXplOyBpKyspIHtcbiAgICAgIHRlbXAucHVzaChibG9iW3N0YXJ0SW5kZXggKyBpXSk7XG4gICAgfVxuICAgIHJldHVybiB0ZW1wO1xuICB9XG5cbiAgcmV0dXJuIGJsb2Jbc3RhcnRJbmRleF07XG59XG5cbmZ1bmN0aW9uIGZvcm1hdEJ5VHlwZShkYXRhOiBhbnksIHR5cGU6IHN0cmluZyxcbiAgc2NhbGU/OiBudW1iZXIsIG9mZnNldD86IG51bWJlcik6IGFueSB7XG4gIHN3aXRjaCAodHlwZSkge1xuICAgIGNhc2UgJ2RhdGVfdGltZSc6XG4gICAgY2FzZSAnbG9jYWxfZGF0ZV90aW1lJzpcbiAgICAgIHJldHVybiBuZXcgRGF0ZSgoZGF0YSAqIDEwMDApICsgNjMxMDY1NjAwMDAwKTtcbiAgICBjYXNlICdzaW50MzInOlxuICAgICAgcmV0dXJuIGRhdGEgKiBGSVRTREsuc2NDb25zdDtcbiAgICBjYXNlICdzaW50MTYnOlxuICAgIGNhc2UgJ3VpbnQzMic6XG4gICAgY2FzZSAndWludDE2JzpcbiAgICAgIHJldHVybiBzY2FsZSA/IGRhdGEgLyBzY2FsZSArIChvZmZzZXQgfHwgMCkgOiBkYXRhO1xuICAgIGNhc2UgJ3VpbnQxNl9hcnJheSc6XG4gICAgICBjb25zdCBkYXRhX2FycmF5ID0gZGF0YSBhcyBudW1iZXJbXVxuICAgICAgcmV0dXJuIGRhdGEubWFwKChkYXRhSXRlbTogbnVtYmVyKSA9PiB7XG4gICAgICAgIGlmIChzY2FsZSkge1xuICAgICAgICAgIHJldHVybiBkYXRhSXRlbSAvIHNjYWxlICsgKG9mZnNldCB8fCAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUl0ZW07XG4gICAgICB9KTtcbiAgICBkZWZhdWx0OiB7XG4gICAgICBpZiAoIUZJVFNESy50eXBlcy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkge1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHQgPSBGSVRTREsudHlwZXNbdHlwZV1cbiAgICAgIGNvbnN0IHRLZXlzID0gT2JqZWN0LmtleXModClcbiAgICAgIC8vIFF1aWNrIGNoZWNrIGZvciBhIG1hc2tcbiAgICAgIGNvbnN0IHZhbHVlczogKHN0cmluZ3xudW1iZXIpW10gPSBbXTtcbiAgICAgIHRLZXlzLmZvckVhY2goKGtleTogc3RyaW5nKSA9PiB7XG4gICAgICAgIHZhbHVlcy5wdXNoKHRbcGFyc2VJbnQoa2V5KV0pO1xuICAgICAgfSk7XG4gICAgICBpZiAodmFsdWVzLmluZGV4T2YoJ21hc2snKSA9PT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIHRbZGF0YV07XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhSXRlbTogeyBba2V5OiBzdHJpbmddOiBudW1iZXJ8Ym9vbGVhbiB9ID0ge307XG4gICAgICB0S2V5cy5mb3JFYWNoKChrZXk6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0W3BhcnNlSW50KGtleSldXG4gICAgICAgICAgaWYgKGl0ZW0gPT09ICdtYXNrJykge1xuICAgICAgICAgICAgZGF0YUl0ZW1bJ3ZhbHVlJ10gPSBkYXRhICYgcGFyc2VJbnQoa2V5KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGF0YUl0ZW1baXRlbV0gPSAhISgoZGF0YSAmIHBhcnNlSW50KGtleSkpID4+IDcpO1xuICAgICAgICAgICAgLy8gTm90IHN1cmUgaWYgd2UgbmVlZCB0aGUgPj4gNyBhbmQgY2FzdGluZyB0byBib29sZWFuIGJ1dCBmcm9tIGFsbFxuICAgICAgICAgICAgLy8gdGhlIG1hc2tlZCBwcm9wcyBvZiBmaWVsZHMgc28gZmFyIHRoaXMgc2VlbXMgdG8gYmUgdGhlIGNhc2VcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRhdGFJdGVtO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBpc0ludmFsaWRWYWx1ZShkYXRhOiBhbnksIHR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdlbnVtJzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGO1xuICAgIGNhc2UgJ3NpbnQ4JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweDdGO1xuICAgIGNhc2UgJ3VpbnQ4JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGO1xuICAgIGNhc2UgJ3NpbnQxNic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHg3RkZGO1xuICAgIGNhc2UgJ3VpbnQxNic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHhGRkZGO1xuICAgIGNhc2UgJ3NpbnQzMic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHg3RkZGRkZGRjtcbiAgICBjYXNlICd1aW50MzInOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkZGRkZGRkY7XG4gICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweDAwO1xuICAgIGNhc2UgJ2Zsb2F0MzInOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkZGRkZGRkY7XG4gICAgY2FzZSAnZmxvYXQ2NCc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHhGRkZGRkZGRkZGRkZGRkZGO1xuICAgIGNhc2UgJ3VpbnQ4eic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDtcbiAgICBjYXNlICd1aW50MTZ6JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweDAwMDA7XG4gICAgY2FzZSAndWludDMyeic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDAwMDA7XG4gICAgY2FzZSAnYnl0ZSc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHhGRjtcbiAgICBjYXNlICdzaW50NjQnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4N0ZGRkZGRkZGRkZGRkZGRjtcbiAgICBjYXNlICd1aW50NjQnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkZGRkZGRkZGRkZGRkZGRjtcbiAgICBjYXNlICd1aW50NjR6JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweDAwMDAwMDAwMDAwMDAwMDA7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjb252ZXJ0VG8oZGF0YTogYW55LCB1bml0c0xpc3Q6IHN0cmluZywgc3BlZWRVbml0OiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCB1bml0T2JqID0gRklUU0RLLm9wdGlvbnNbdW5pdHNMaXN0XVtzcGVlZFVuaXRdO1xuICByZXR1cm4gdW5pdE9iaiA/IGRhdGEgKiB1bml0T2JqLm11bHRpcGxpZXIgKyB1bml0T2JqLm9mZnNldCA6IGRhdGE7XG59XG5cbmZ1bmN0aW9uIGFwcGx5T3B0aW9ucyhkYXRhOiBhbnksIGZpZWxkOiBzdHJpbmcsIG9wdGlvbnM6IEZpdFBhcnNlck9wdGlvbnMpOiBhbnkge1xuICBzd2l0Y2ggKGZpZWxkKSB7XG4gICAgY2FzZSAnc3BlZWQnOlxuICAgIGNhc2UgJ2VuaGFuY2VkX3NwZWVkJzpcbiAgICBjYXNlICd2ZXJ0aWNhbF9zcGVlZCc6XG4gICAgY2FzZSAnYXZnX3NwZWVkJzpcbiAgICBjYXNlICdtYXhfc3BlZWQnOlxuICAgIGNhc2UgJ3NwZWVkXzFzJzpcbiAgICBjYXNlICdiYWxsX3NwZWVkJzpcbiAgICBjYXNlICdlbmhhbmNlZF9hdmdfc3BlZWQnOlxuICAgIGNhc2UgJ2VuaGFuY2VkX21heF9zcGVlZCc6XG4gICAgY2FzZSAnYXZnX3Bvc192ZXJ0aWNhbF9zcGVlZCc6XG4gICAgY2FzZSAnbWF4X3Bvc192ZXJ0aWNhbF9zcGVlZCc6XG4gICAgY2FzZSAnYXZnX25lZ192ZXJ0aWNhbF9zcGVlZCc6XG4gICAgY2FzZSAnbWF4X25lZ192ZXJ0aWNhbF9zcGVlZCc6XG4gICAgICBpZiAob3B0aW9ucy5zcGVlZFVuaXQpIHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRUbyhkYXRhLCAnc3BlZWRVbml0cycsIG9wdGlvbnMuc3BlZWRVbml0KTtcbiAgICAgIH1cbiAgICBjYXNlICdkaXN0YW5jZSc6XG4gICAgY2FzZSAndG90YWxfZGlzdGFuY2UnOlxuICAgIGNhc2UgJ2VuaGFuY2VkX2F2Z19hbHRpdHVkZSc6XG4gICAgY2FzZSAnZW5oYW5jZWRfbWluX2FsdGl0dWRlJzpcbiAgICBjYXNlICdlbmhhbmNlZF9tYXhfYWx0aXR1ZGUnOlxuICAgIGNhc2UgJ2VuaGFuY2VkX2FsdGl0dWRlJzpcbiAgICBjYXNlICdoZWlnaHQnOlxuICAgIGNhc2UgJ29kb21ldGVyJzpcbiAgICBjYXNlICdhdmdfc3Ryb2tlX2Rpc3RhbmNlJzpcbiAgICBjYXNlICdtaW5fYWx0aXR1ZGUnOlxuICAgIGNhc2UgJ2F2Z19hbHRpdHVkZSc6XG4gICAgY2FzZSAnbWF4X2FsdGl0dWRlJzpcbiAgICBjYXNlICd0b3RhbF9hc2NlbnQnOlxuICAgIGNhc2UgJ3RvdGFsX2Rlc2NlbnQnOlxuICAgIGNhc2UgJ2FsdGl0dWRlJzpcbiAgICBjYXNlICdjeWNsZV9sZW5ndGgnOlxuICAgIGNhc2UgJ2F1dG9fd2hlZWxzaXplJzpcbiAgICBjYXNlICdjdXN0b21fd2hlZWxzaXplJzpcbiAgICBjYXNlICdncHNfYWNjdXJhY3knOlxuICAgICAgaWYgKG9wdGlvbnMubGVuZ3RoVW5pdCkge1xuICAgICAgICByZXR1cm4gY29udmVydFRvKGRhdGEsICdsZW5ndGhVbml0cycsIG9wdGlvbnMubGVuZ3RoVW5pdCk7XG4gICAgICB9XG4gICAgY2FzZSAndGVtcGVyYXR1cmUnOlxuICAgIGNhc2UgJ2F2Z190ZW1wZXJhdHVyZSc6XG4gICAgY2FzZSAnbWF4X3RlbXBlcmF0dXJlJzpcbiAgICAgIGlmIChvcHRpb25zLnRlbXBlcmF0dXJlVW5pdCkge1xuICAgICAgICByZXR1cm4gY29udmVydFRvKGRhdGEsICd0ZW1wZXJhdHVyZVVuaXRzJyxcbiAgICAgICAgICBvcHRpb25zLnRlbXBlcmF0dXJlVW5pdCk7XG4gICAgICB9XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBkYXRhO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkUmVjb3JkKGJsb2I6IFVpbnQ4QXJyYXksXG4gIG1lc3NhZ2VUeXBlczogTWVzc2FnZVR5cGVzLFxuICBkZXZlbG9wZXJGaWVsZHM6IERldmVsb3BlckZpZWxkcyxcbiAgc3RhcnRJbmRleDogbnVtYmVyLCBvcHRpb25zOiBGaXRQYXJzZXJPcHRpb25zLFxuICBzdGFydERhdGU6IG51bWJlciwgcGF1c2VkVGltZTogbnVtYmVyKTogUmVhZFJlc3VsdCB7XG4gIGNvbnN0IHJlY29yZEhlYWRlciA9IGJsb2Jbc3RhcnRJbmRleF07XG4gIGNvbnN0IGxvY2FsTWVzc2FnZVR5cGUgPSByZWNvcmRIZWFkZXIgJiAxNTtcblxuICBpZiAoKHJlY29yZEhlYWRlciAmIDY0KSA9PT0gNjQpIHtcbiAgICAvLyBpcyBkZWZpbml0aW9uIG1lc3NhZ2VcbiAgICAvLyBzdGFydEluZGV4ICsgMSBpcyByZXNlcnZlZFxuXG4gICAgY29uc3QgaGFzRGV2ZWxvcGVyRGF0YSA9IChyZWNvcmRIZWFkZXIgJiAzMikgPT09IDMyO1xuICAgIGNvbnN0IGxFbmQgPSBibG9iW3N0YXJ0SW5kZXggKyAyXSA9PT0gMDtcbiAgICBjb25zdCBudW1iZXJPZkZpZWxkcyA9IGJsb2Jbc3RhcnRJbmRleCArIDVdO1xuICAgIGNvbnN0IG51bWJlck9mRGV2ZWxvcGVyRGF0YUZpZWxkcyA9IGhhc0RldmVsb3BlckRhdGEgPyBibG9iW3N0YXJ0SW5kZXggKyA1ICsgbnVtYmVyT2ZGaWVsZHMgKiAzICsgMV0gOiAwO1xuXG4gICAgY29uc3QgbVR5cGVEZWY6IFR5cGVEZWYgPSB7XG4gICAgICBsaXR0bGVFbmRpYW46IGxFbmQsXG4gICAgICBnbG9iYWxNZXNzYWdlTnVtYmVyOiBhZGRFbmRpYW4obEVuZCwgW2Jsb2Jbc3RhcnRJbmRleCArIDNdLCBibG9iW3N0YXJ0SW5kZXggKyA0XV0pLFxuICAgICAgbnVtYmVyT2ZGaWVsZHM6IG51bWJlck9mRmllbGRzICsgbnVtYmVyT2ZEZXZlbG9wZXJEYXRhRmllbGRzLFxuICAgICAgZmllbGREZWZzOiBbXSxcbiAgICB9O1xuXG4gICAgY29uc3QgbWVzc2FnZSA9IGdldEZpdE1lc3NhZ2UobVR5cGVEZWYuZ2xvYmFsTWVzc2FnZU51bWJlcik7XG4gICAgY29uc29sZS5sb2cobWVzc2FnZSlcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZGaWVsZHM7IGkrKykge1xuICAgICAgY29uc3QgZkRlZkluZGV4ID0gc3RhcnRJbmRleCArIDYgKyAoaSAqIDMpO1xuICAgICAgY29uc3QgYmFzZVR5cGUgPSBibG9iW2ZEZWZJbmRleCArIDJdO1xuICAgICAgY29uc3QgeyBmaWVsZCwgdHlwZSB9ID0gbWVzc2FnZS5nZXRBdHRyaWJ1dGVzKGJsb2JbZkRlZkluZGV4XSk7IFxuICAgICAgaWYgKGZpZWxkKSB7XG4gICAgICBjb25zdCBmRGVmOiBEZWYgPSB7XG4gICAgICAgIHR5cGUsXG4gICAgICAgIGZEZWZObzogYmxvYltmRGVmSW5kZXhdLFxuICAgICAgICBzaXplOiBibG9iW2ZEZWZJbmRleCArIDFdLFxuICAgICAgICBlbmRpYW5BYmlsaXR5OiAoYmFzZVR5cGUgJiAxMjgpID09PSAxMjgsXG4gICAgICAgIGxpdHRsZUVuZGlhbjogbEVuZCxcbiAgICAgICAgYmFzZVR5cGVObzogKGJhc2VUeXBlICYgMTUpLFxuICAgICAgICBuYW1lOiBmaWVsZCxcbiAgICAgICAgZGF0YVR5cGU6IGdldEZpdE1lc3NhZ2VCYXNlVHlwZShiYXNlVHlwZSAmIDE1KSxcbiAgICAgIH07XG5cbiAgICAgICAgbVR5cGVEZWYuZmllbGREZWZzLnB1c2goZkRlZik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkRldmVsb3BlckRhdGFGaWVsZHM7IGkrKykge1xuICAgICAgLy8gSWYgd2UgZmFpbCB0byBwYXJzZSB0aGVuIHRyeSBjYXRjaFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZkRlZkluZGV4ID0gc3RhcnRJbmRleCArIDYgKyAobnVtYmVyT2ZGaWVsZHMgKiAzKSArIDEgKyAoaSAqIDMpO1xuXG4gICAgICAgIGNvbnN0IGZpZWxkTnVtID0gYmxvYltmRGVmSW5kZXhdO1xuICAgICAgICBjb25zdCBzaXplID0gYmxvYltmRGVmSW5kZXggKyAxXTtcbiAgICAgICAgY29uc3QgZGV2RGF0YUluZGV4ID0gYmxvYltmRGVmSW5kZXggKyAyXTtcblxuICAgICAgICBjb25zdCBkZXZEZWYgPSBkZXZlbG9wZXJGaWVsZHNbZGV2RGF0YUluZGV4XVtmaWVsZE51bV07XG5cbiAgICAgICAgY29uc3QgYmFzZVR5cGUgPSBkZXZEZWYuZml0X2Jhc2VfdHlwZV9pZDtcblxuICAgICAgICBjb25zdCBmRGVmID0ge1xuICAgICAgICAgIHR5cGU6IEZJVFNESy50eXBlcy5maXRfYmFzZV90eXBlW2Jhc2VUeXBlXSxcbiAgICAgICAgICBzaXplLFxuICAgICAgICAgIGZEZWZObzogZmllbGROdW0sXG4gICAgICAgICAgZW5kaWFuQWJpbGl0eTogKGJhc2VUeXBlICYgMTI4KSA9PT0gMTI4LFxuICAgICAgICAgIGxpdHRsZUVuZGlhbjogbEVuZCxcbiAgICAgICAgICBiYXNlVHlwZU5vOiAoYmFzZVR5cGUgJiAxNSksXG4gICAgICAgICAgbmFtZTogZGV2RGVmLmZpZWxkX25hbWUsXG4gICAgICAgICAgZGF0YVR5cGU6IGdldEZpdE1lc3NhZ2VCYXNlVHlwZShiYXNlVHlwZSAmIDE1KSxcbiAgICAgICAgICBzY2FsZTogZGV2RGVmLnNjYWxlIHx8IDEsXG4gICAgICAgICAgb2Zmc2V0OiBkZXZEZWYub2Zmc2V0IHx8IDAsXG4gICAgICAgICAgZGV2ZWxvcGVyRGF0YUluZGV4OiBkZXZEYXRhSW5kZXgsXG4gICAgICAgICAgaXNEZXZlbG9wZXJGaWVsZDogdHJ1ZSxcbiAgICAgICAgfTtcblxuICAgICAgICBtVHlwZURlZi5maWVsZERlZnMucHVzaChmRGVmKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuZm9yY2UpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgIH1cblxuICAgIG1lc3NhZ2VUeXBlc1tsb2NhbE1lc3NhZ2VUeXBlXSA9IG1UeXBlRGVmO1xuXG4gICAgY29uc3QgbmV4dEluZGV4ID0gc3RhcnRJbmRleCArIDYgKyAobVR5cGVEZWYubnVtYmVyT2ZGaWVsZHMgKiAzKTtcbiAgICBjb25zdCBuZXh0SW5kZXhXaXRoRGV2ZWxvcGVyRGF0YSA9IG5leHRJbmRleCArIDE7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbWVzc2FnZVR5cGU6ICdkZWZpbml0aW9uJyxcbiAgICAgIG5leHRJbmRleDogaGFzRGV2ZWxvcGVyRGF0YSA/IG5leHRJbmRleFdpdGhEZXZlbG9wZXJEYXRhIDogbmV4dEluZGV4LFxuICAgIH07XG4gIH1cblxuICBjb25zdCBtZXNzYWdlVHlwZSA9IG1lc3NhZ2VUeXBlc1tsb2NhbE1lc3NhZ2VUeXBlXSB8fCBtZXNzYWdlVHlwZXNbMF07XG5cbiAgLy8gVE9ETzogaGFuZGxlIGNvbXByZXNzZWQgaGVhZGVyICgocmVjb3JkSGVhZGVyICYgMTI4KSA9PSAxMjgpXG5cbiAgLy8gdW5jb21wcmVzc2VkIGhlYWRlclxuICBsZXQgbWVzc2FnZVNpemUgPSAwO1xuICBsZXQgcmVhZERhdGFGcm9tSW5kZXggPSBzdGFydEluZGV4ICsgMTtcbiAgY29uc3QgZmllbGRzOiBGaWVsZHMgPSB7fTtcblxuICBjb25zdCBtZXNzYWdlID0gZ2V0Rml0TWVzc2FnZShtZXNzYWdlVHlwZS5nbG9iYWxNZXNzYWdlTnVtYmVyKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IG1lc3NhZ2VUeXBlLmZpZWxkRGVmcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGZEZWYgPSBtZXNzYWdlVHlwZS5maWVsZERlZnNbaV07XG4gICAgY29uc3QgZGF0YSA9IHJlYWREYXRhKGJsb2IsIGZEZWYsIHJlYWREYXRhRnJvbUluZGV4LCBvcHRpb25zKTtcblxuICAgIGlmICghaXNJbnZhbGlkVmFsdWUoZGF0YSwgZkRlZi50eXBlKSkge1xuICAgICAgaWYgKGZEZWYuaXNEZXZlbG9wZXJGaWVsZCkge1xuICAgICAgICBjb25zdCBmaWVsZCA9IGZEZWYubmFtZTtcbiAgICAgICAgY29uc3QgeyB0eXBlLCBzY2FsZSwgb2Zmc2V0IH0gPSBmRGVmO1xuICAgICAgICBcbiAgICAgICAgaWYgKHR5cGUpIHtcbiAgICAgICAgICBmaWVsZHNbZkRlZi5uYW1lXSA9IGFwcGx5T3B0aW9ucyhmb3JtYXRCeVR5cGUoZGF0YSwgdHlwZSwgc2NhbGUgYXMgbnVtYmVyLCBvZmZzZXQgYXMgbnVtYmVyKSwgZmllbGQsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCB7IGZpZWxkLCB0eXBlLCBzY2FsZSwgb2Zmc2V0IH0gPSBtZXNzYWdlLmdldEF0dHJpYnV0ZXMoZkRlZi5mRGVmTm8pO1xuXG4gICAgICAgIGlmIChmaWVsZCAhPT0gJ3Vua25vd24nICYmIGZpZWxkICE9PSAnJyAmJiBmaWVsZCAhPT0gdW5kZWZpbmVkICYmIHR5cGUpIHtcbiAgICAgICAgICBmaWVsZHNbZmllbGRdID0gYXBwbHlPcHRpb25zKGZvcm1hdEJ5VHlwZShkYXRhLCB0eXBlLCBzY2FsZSBhcyBudW1iZXIsIG9mZnNldCBhcyBudW1iZXIpLCBmaWVsZCwgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChtZXNzYWdlLm5hbWUgPT09ICdyZWNvcmQnICYmIG9wdGlvbnMuZWxhcHNlZFJlY29yZEZpZWxkICYmXG4gICAgICAgICAgZmllbGRzLnRpbWVzdGFtcCkge1xuICAgICAgICBmaWVsZHMuZWxhcHNlZF90aW1lID0gKGZpZWxkcy50aW1lc3RhbXAgLSBzdGFydERhdGUpIC8gMTAwMDtcbiAgICAgICAgZmllbGRzLnRpbWVyX3RpbWUgPSBmaWVsZHMuZWxhcHNlZF90aW1lIC0gcGF1c2VkVGltZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZWFkRGF0YUZyb21JbmRleCArPSBmRGVmLnNpemU7XG4gICAgbWVzc2FnZVNpemUgKz0gZkRlZi5zaXplO1xuICB9XG5cbiAgaWYgKG1lc3NhZ2UubmFtZSA9PT0gJ2ZpZWxkX2Rlc2NyaXB0aW9uJykge1xuICAgIGlmIChmaWVsZHMuZGV2ZWxvcGVyX2RhdGFfaW5kZXggJiYgZmllbGRzLmZpZWxkX2RlZmluaXRpb25fbnVtYmVyKSB7XG4gICAgICBkZXZlbG9wZXJGaWVsZHNbZmllbGRzLmRldmVsb3Blcl9kYXRhX2luZGV4XSA9XG4gICAgICAgIGRldmVsb3BlckZpZWxkc1tmaWVsZHMuZGV2ZWxvcGVyX2RhdGFfaW5kZXhdIHx8IFtdO1xuICAgICAgZGV2ZWxvcGVyRmllbGRzW2ZpZWxkcy5kZXZlbG9wZXJfZGF0YV9pbmRleF1bZmllbGRzLmZpZWxkX2RlZmluaXRpb25fbnVtYmVyXSA9XG4gICAgICAgIGZpZWxkcztcbiAgICB9XG4gIH1cblxuICBjb25zdCByZXN1bHQgPSB7XG4gICAgbWVzc2FnZVR5cGU6IG1lc3NhZ2UubmFtZSxcbiAgICBuZXh0SW5kZXg6IHN0YXJ0SW5kZXggKyBtZXNzYWdlU2l6ZSArIDEsXG4gICAgbWVzc2FnZTogZmllbGRzLFxuICB9O1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcnJheUJ1ZmZlcihidWZmZXI6IEFycmF5QnVmZmVyfEJ1ZmZlcikge1xuICBpZiAoYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHtcbiAgICByZXR1cm4gYnVmZmVyO1xuICB9XG4gIGNvbnN0IGFiID0gbmV3IEFycmF5QnVmZmVyKGJ1ZmZlci5sZW5ndGgpO1xuICBjb25zdCB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoYWIpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1ZmZlci5sZW5ndGg7ICsraSkge1xuICAgIHZpZXdbaV0gPSBidWZmZXJbaV07XG4gIH1cbiAgcmV0dXJuIGFiO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQ1JDKGJsb2I6IFVpbnQ4QXJyYXksIHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKSB7XG4gIGNvbnN0IGNyY1RhYmxlID0gW1xuICAgIDB4MDAwMCwgMHhDQzAxLCAweEQ4MDEsIDB4MTQwMCwgMHhGMDAxLCAweDNDMDAsIDB4MjgwMCwgMHhFNDAxLFxuICAgIDB4QTAwMSwgMHg2QzAwLCAweDc4MDAsIDB4QjQwMSwgMHg1MDAwLCAweDlDMDEsIDB4ODgwMSwgMHg0NDAwLFxuICBdO1xuXG4gIGxldCBjcmMgPSAwO1xuICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgIGNvbnN0IGJ5dGUgPSBibG9iW2ldO1xuICAgIGxldCB0bXAgPSBjcmNUYWJsZVtjcmMgJiAweEZdO1xuICAgIGNyYyA9IChjcmMgPj4gNCkgJiAweDBGRkY7XG4gICAgY3JjID0gY3JjIF4gdG1wIF4gY3JjVGFibGVbYnl0ZSAmIDB4Rl07XG4gICAgdG1wID0gY3JjVGFibGVbY3JjICYgMHhGXTtcbiAgICBjcmMgPSAoY3JjID4+IDQpICYgMHgwRkZGO1xuICAgIGNyYyA9IGNyYyBeIHRtcCBeIGNyY1RhYmxlWyhieXRlID4+IDQpICYgMHhGXTtcbiAgfVxuXG4gIHJldHVybiBjcmM7XG59XG4iXX0=