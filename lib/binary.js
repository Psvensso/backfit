"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.addEndian = addEndian;
exports.readRecord = readRecord;
exports.getArrayBuffer = getArrayBuffer;
exports.calculateCRC = calculateCRC;

var _sdk = require("./sdk");

var _messages = require("./messages");

function addEndian(littleEndian, bytes) {
  var result = 0;
  if (!littleEndian) bytes.reverse();

  for (var i = 0; i < bytes.length; i++) {
    result += bytes[i] << (i << 3) >>> 0;
  }

  return result;
}

function readData(blob, fDef, startIndex, options) {
  if (fDef.endianAbility === true) {
    var temp = [];

    for (var i = 0; i < fDef.size; i++) {
      temp.push(blob[startIndex + i]);
    }

    var _ref = new Uint8Array(temp),
        buffer = _ref.buffer;

    var dataView = new DataView(buffer);

    try {
      switch (fDef.type) {
        case 'sint16':
          return dataView.getInt16(0, fDef.littleEndian);

        case 'uint16':
        case 'uint16z':
          return dataView.getUint16(0, fDef.littleEndian);

        case 'sint32':
          return dataView.getInt32(0, fDef.littleEndian);

        case 'uint32':
        case 'uint32z':
          return dataView.getUint32(0, fDef.littleEndian);

        case 'float32':
          return dataView.getFloat32(0, fDef.littleEndian);

        case 'float64':
          return dataView.getFloat64(0, fDef.littleEndian);

        case 'uint16_array':
          {
            var array = [];

            for (var _i = 0; _i < fDef.size; _i += 2) {
              array.push(dataView.getUint16(_i, fDef.littleEndian));
            }

            return array;
          }

        default:
          throw Error('No type');
      }
    } catch (e) {
      if (!options.force) {
        throw e;
      }
    }

    return addEndian(fDef.littleEndian, temp);
  }

  if (fDef.type === 'string') {
    var _temp = [];

    for (var _i2 = 0; _i2 < fDef.size; _i2++) {
      if (blob[startIndex + _i2]) {
        _temp.push(blob[startIndex + _i2]);
      }
    }

    return Buffer.from(_temp).toString('utf-8');
  }

  if (fDef.type === 'byte_array') {
    var _temp2 = [];

    for (var _i3 = 0; _i3 < fDef.size; _i3++) {
      _temp2.push(blob[startIndex + _i3]);
    }

    return _temp2;
  }

  return blob[startIndex];
}

function formatByType(data, type, scale, offset) {
  switch (type) {
    case 'date_time':
    case 'local_date_time':
      return new Date(data * 1000 + 631065600000);

    case 'sint32':
      return data * _sdk.FITSDK.scConst;

    case 'sint16':
    case 'uint32':
    case 'uint16':
      return scale ? data / scale + offset : data;

    case 'uint16_array':
      var data_array = data;
      return data.map(function (dataItem) {
        if (scale) {
          return dataItem / scale + offset;
        }

        return dataItem;
      });

    default:
      {
        if (!_sdk.FITSDK.types.hasOwnProperty(type)) {
          return data;
        }

        var types = _sdk.FITSDK.types[type]; // Quick check for a mask

        var values = [];
        Object.keys(types).forEach(function (key, _) {
          values.push(types[key]);
        });

        if (values.indexOf('mask') === -1) {
          return types[data];
        }

        var dataItem = {};
        Object.keys(types).forEach(function (key, _) {
          var item = types[key];

          if (item === 'mask') {
            dataItem['value'] = data & parseInt(key);
          } else {
            dataItem[item] = !!((data & parseInt(key)) >> 7); // Not sure if we need the >> 7 and casting to boolean but from all
            // the masked props of fields so far this seems to be the case
          }
        });
        return dataItem;
      }
  }
}

function isInvalidValue(data, type) {
  switch (type) {
    case 'enum':
      return data === 0xFF;

    case 'sint8':
      return data === 0x7F;

    case 'uint8':
      return data === 0xFF;

    case 'sint16':
      return data === 0x7FFF;

    case 'uint16':
      return data === 0xFFFF;

    case 'sint32':
      return data === 0x7FFFFFFF;

    case 'uint32':
      return data === 0xFFFFFFFF;

    case 'string':
      return data === 0x00;

    case 'float32':
      return data === 0xFFFFFFFF;

    case 'float64':
      return data === 0xFFFFFFFFFFFFFFFF;

    case 'uint8z':
      return data === 0x00;

    case 'uint16z':
      return data === 0x0000;

    case 'uint32z':
      return data === 0x000000;

    case 'byte':
      return data === 0xFF;

    case 'sint64':
      return data === 0x7FFFFFFFFFFFFFFF;

    case 'uint64':
      return data === 0xFFFFFFFFFFFFFFFF;

    case 'uint64z':
      return data === 0x0000000000000000;

    default:
      return false;
  }
}

function convertTo(data, unitsList, speedUnit) {
  var unitObj = _sdk.FITSDK.options[unitsList][speedUnit];
  return unitObj ? data * unitObj.multiplier + unitObj.offset : data;
}

function applyOptions(data, field, options) {
  switch (field) {
    case 'speed':
    case 'enhanced_speed':
    case 'vertical_speed':
    case 'avg_speed':
    case 'max_speed':
    case 'speed_1s':
    case 'ball_speed':
    case 'enhanced_avg_speed':
    case 'enhanced_max_speed':
    case 'avg_pos_vertical_speed':
    case 'max_pos_vertical_speed':
    case 'avg_neg_vertical_speed':
    case 'max_neg_vertical_speed':
      return convertTo(data, 'speedUnits', options.speedUnit);

    case 'distance':
    case 'total_distance':
    case 'enhanced_avg_altitude':
    case 'enhanced_min_altitude':
    case 'enhanced_max_altitude':
    case 'enhanced_altitude':
    case 'height':
    case 'odometer':
    case 'avg_stroke_distance':
    case 'min_altitude':
    case 'avg_altitude':
    case 'max_altitude':
    case 'total_ascent':
    case 'total_descent':
    case 'altitude':
    case 'cycle_length':
    case 'auto_wheelsize':
    case 'custom_wheelsize':
    case 'gps_accuracy':
      return convertTo(data, 'lengthUnits', options.lengthUnit);

    case 'temperature':
    case 'avg_temperature':
    case 'max_temperature':
      return convertTo(data, 'temperatureUnits', options.temperatureUnit);

    default:
      return data;
  }
}

function readRecord(blob, messageTypes, developerFields, startIndex, options, startDate, pausedTime) {
  var recordHeader = blob[startIndex];
  var localMessageType = recordHeader & 15;

  if ((recordHeader & 64) === 64) {
    // is definition message
    // startIndex + 1 is reserved
    var hasDeveloperData = (recordHeader & 32) === 32;
    var lEnd = blob[startIndex + 2] === 0;
    var numberOfFields = blob[startIndex + 5];
    var numberOfDeveloperDataFields = hasDeveloperData ? blob[startIndex + 5 + numberOfFields * 3 + 1] : 0;
    var mTypeDef = {
      littleEndian: lEnd,
      globalMessageNumber: addEndian(lEnd, [blob[startIndex + 3], blob[startIndex + 4]]),
      numberOfFields: numberOfFields + numberOfDeveloperDataFields,
      fieldDefs: []
    };

    var _message = (0, _messages.getFitMessage)(mTypeDef.globalMessageNumber);

    for (var i = 0; i < numberOfFields; i++) {
      var fDefIndex = startIndex + 6 + i * 3;
      var baseType = blob[fDefIndex + 2];

      var _message$getAttribute = _message.getAttributes(blob[fDefIndex]),
          field = _message$getAttribute.field,
          type = _message$getAttribute.type;

      var fDef = {
        type: type,
        fDefNo: blob[fDefIndex],
        size: blob[fDefIndex + 1],
        endianAbility: (baseType & 128) === 128,
        littleEndian: lEnd,
        baseTypeNo: baseType & 15,
        name: field,
        dataType: (0, _messages.getFitMessageBaseType)(baseType & 15)
      };
      mTypeDef.fieldDefs.push(fDef);
    }

    for (var _i4 = 0; _i4 < numberOfDeveloperDataFields; _i4++) {
      // If we fail to parse then try catch
      try {
        var _fDefIndex = startIndex + 6 + numberOfFields * 3 + 1 + _i4 * 3;

        var fieldNum = blob[_fDefIndex];
        var size = blob[_fDefIndex + 1];
        var devDataIndex = blob[_fDefIndex + 2];
        var devDef = developerFields[devDataIndex][fieldNum];
        var _baseType = devDef.fit_base_type_id;
        var _fDef = {
          type: _sdk.FITSDK.types.fit_base_type[_baseType],
          size: size,
          fDefNo: fieldNum,
          endianAbility: (_baseType & 128) === 128,
          littleEndian: lEnd,
          baseTypeNo: _baseType & 15,
          name: devDef.field_name,
          dataType: (0, _messages.getFitMessageBaseType)(_baseType & 15),
          scale: devDef.scale || 1,
          offset: devDef.offset || 0,
          developerDataIndex: devDataIndex,
          isDeveloperField: true
        };
        mTypeDef.fieldDefs.push(_fDef);
      } catch (e) {
        if (options.force) {
          continue;
        }

        throw e;
      }
    }

    messageTypes[localMessageType] = mTypeDef;
    var nextIndex = startIndex + 6 + mTypeDef.numberOfFields * 3;
    var nextIndexWithDeveloperData = nextIndex + 1;
    return {
      messageType: 'definition',
      nextIndex: hasDeveloperData ? nextIndexWithDeveloperData : nextIndex
    };
  }

  var messageType = messageTypes[localMessageType] || messageTypes[0]; // TODO: handle compressed header ((recordHeader & 128) == 128)
  // uncompressed header

  var messageSize = 0;
  var readDataFromIndex = startIndex + 1;
  var fields = {};
  var message = (0, _messages.getFitMessage)(messageType.globalMessageNumber);

  for (var _i5 = 0; _i5 < messageType.fieldDefs.length; _i5++) {
    var _fDef2 = messageType.fieldDefs[_i5];
    var data = readData(blob, _fDef2, readDataFromIndex, options);

    if (!isInvalidValue(data, _fDef2.type)) {
      if (_fDef2.isDeveloperField) {
        var field = _fDef2.name;
        var type = _fDef2.type,
            scale = _fDef2.scale,
            offset = _fDef2.offset;
        fields[_fDef2.name] = applyOptions(formatByType(data, type, scale, offset), field, options);
      } else {
        var _message$getAttribute2 = message.getAttributes(_fDef2.fDefNo),
            _field = _message$getAttribute2.field,
            _type = _message$getAttribute2.type,
            _scale = _message$getAttribute2.scale,
            _offset = _message$getAttribute2.offset;

        if (_field !== 'unknown' && _field !== '' && _field !== undefined) {
          fields[_field] = applyOptions(formatByType(data, _type, _scale, _offset), _field, options);
        }
      }

      if (message.name === 'record' && options.elapsedRecordField) {
        fields.elapsed_time = (fields.timestamp - startDate) / 1000;
        fields.timer_time = fields.elapsed_time - pausedTime;
      }
    }

    readDataFromIndex += _fDef2.size;
    messageSize += _fDef2.size;
  }

  if (message.name === 'field_description') {
    developerFields[fields.developer_data_index] = developerFields[fields.developer_data_index] || [];
    developerFields[fields.developer_data_index][fields.field_definition_number] = fields;
  }

  var result = {
    messageType: message.name,
    nextIndex: startIndex + messageSize + 1,
    message: fields
  };
  return result;
}

function getArrayBuffer(buffer) {
  if (buffer instanceof ArrayBuffer) {
    return buffer;
  }

  var ab = new ArrayBuffer(buffer.length);
  var view = new Uint8Array(ab);

  for (var i = 0; i < buffer.length; ++i) {
    view[i] = buffer[i];
  }

  return ab;
}

function calculateCRC(blob, start, end) {
  var crcTable = [0x0000, 0xCC01, 0xD801, 0x1400, 0xF001, 0x3C00, 0x2800, 0xE401, 0xA001, 0x6C00, 0x7800, 0xB401, 0x5000, 0x9C01, 0x8801, 0x4400];
  var crc = 0;

  for (var i = start; i < end; i++) {
    var _byte = blob[i];
    var tmp = crcTable[crc & 0xF];
    crc = crc >> 4 & 0x0FFF;
    crc = crc ^ tmp ^ crcTable[_byte & 0xF];
    tmp = crcTable[crc & 0xF];
    crc = crc >> 4 & 0x0FFF;
    crc = crc ^ tmp ^ crcTable[_byte >> 4 & 0xF];
  }

  return crc;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9iaW5hcnkudHMiXSwibmFtZXMiOlsiYWRkRW5kaWFuIiwibGl0dGxlRW5kaWFuIiwiYnl0ZXMiLCJyZXN1bHQiLCJyZXZlcnNlIiwiaSIsImxlbmd0aCIsInJlYWREYXRhIiwiYmxvYiIsImZEZWYiLCJzdGFydEluZGV4Iiwib3B0aW9ucyIsImVuZGlhbkFiaWxpdHkiLCJ0ZW1wIiwic2l6ZSIsInB1c2giLCJVaW50OEFycmF5IiwiYnVmZmVyIiwiZGF0YVZpZXciLCJEYXRhVmlldyIsInR5cGUiLCJnZXRJbnQxNiIsImdldFVpbnQxNiIsImdldEludDMyIiwiZ2V0VWludDMyIiwiZ2V0RmxvYXQzMiIsImdldEZsb2F0NjQiLCJhcnJheSIsIkVycm9yIiwiZSIsImZvcmNlIiwiQnVmZmVyIiwiZnJvbSIsInRvU3RyaW5nIiwiZm9ybWF0QnlUeXBlIiwiZGF0YSIsInNjYWxlIiwib2Zmc2V0IiwiRGF0ZSIsIkZJVFNESyIsInNjQ29uc3QiLCJkYXRhX2FycmF5IiwibWFwIiwiZGF0YUl0ZW0iLCJ0eXBlcyIsImhhc093blByb3BlcnR5IiwidmFsdWVzIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJrZXkiLCJfIiwiaW5kZXhPZiIsIml0ZW0iLCJwYXJzZUludCIsImlzSW52YWxpZFZhbHVlIiwiY29udmVydFRvIiwidW5pdHNMaXN0Iiwic3BlZWRVbml0IiwidW5pdE9iaiIsIm11bHRpcGxpZXIiLCJhcHBseU9wdGlvbnMiLCJmaWVsZCIsImxlbmd0aFVuaXQiLCJ0ZW1wZXJhdHVyZVVuaXQiLCJyZWFkUmVjb3JkIiwibWVzc2FnZVR5cGVzIiwiZGV2ZWxvcGVyRmllbGRzIiwic3RhcnREYXRlIiwicGF1c2VkVGltZSIsInJlY29yZEhlYWRlciIsImxvY2FsTWVzc2FnZVR5cGUiLCJoYXNEZXZlbG9wZXJEYXRhIiwibEVuZCIsIm51bWJlck9mRmllbGRzIiwibnVtYmVyT2ZEZXZlbG9wZXJEYXRhRmllbGRzIiwibVR5cGVEZWYiLCJnbG9iYWxNZXNzYWdlTnVtYmVyIiwiZmllbGREZWZzIiwibWVzc2FnZSIsImZEZWZJbmRleCIsImJhc2VUeXBlIiwiZ2V0QXR0cmlidXRlcyIsImZEZWZObyIsImJhc2VUeXBlTm8iLCJuYW1lIiwiZGF0YVR5cGUiLCJmaWVsZE51bSIsImRldkRhdGFJbmRleCIsImRldkRlZiIsImZpdF9iYXNlX3R5cGVfaWQiLCJmaXRfYmFzZV90eXBlIiwiZmllbGRfbmFtZSIsImRldmVsb3BlckRhdGFJbmRleCIsImlzRGV2ZWxvcGVyRmllbGQiLCJuZXh0SW5kZXgiLCJuZXh0SW5kZXhXaXRoRGV2ZWxvcGVyRGF0YSIsIm1lc3NhZ2VUeXBlIiwibWVzc2FnZVNpemUiLCJyZWFkRGF0YUZyb21JbmRleCIsImZpZWxkcyIsInVuZGVmaW5lZCIsImVsYXBzZWRSZWNvcmRGaWVsZCIsImVsYXBzZWRfdGltZSIsInRpbWVzdGFtcCIsInRpbWVyX3RpbWUiLCJkZXZlbG9wZXJfZGF0YV9pbmRleCIsImZpZWxkX2RlZmluaXRpb25fbnVtYmVyIiwiZ2V0QXJyYXlCdWZmZXIiLCJBcnJheUJ1ZmZlciIsImFiIiwidmlldyIsImNhbGN1bGF0ZUNSQyIsInN0YXJ0IiwiZW5kIiwiY3JjVGFibGUiLCJjcmMiLCJieXRlIiwidG1wIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBSU8sU0FBU0EsU0FBVCxDQUFtQkMsWUFBbkIsRUFBMENDLEtBQTFDLEVBQW1FO0FBQ3hFLE1BQUlDLE1BQU0sR0FBRyxDQUFiO0FBQ0EsTUFBSSxDQUFDRixZQUFMLEVBQW1CQyxLQUFLLENBQUNFLE9BQU47O0FBQ25CLE9BQUssSUFBSUMsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gsS0FBSyxDQUFDSSxNQUExQixFQUFrQ0QsQ0FBQyxFQUFuQyxFQUF1QztBQUNyQ0YsSUFBQUEsTUFBTSxJQUFLRCxLQUFLLENBQUNHLENBQUQsQ0FBTCxLQUFhQSxDQUFDLElBQUksQ0FBbEIsQ0FBRCxLQUEyQixDQUFyQztBQUNEOztB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R0FBUixDQUExQjtBQUNBQyxJQUFBQSxHQUFHLEdBQUdILFFBQVEsQ0FBQ0MsR0FBRyxHQUFHLEdBQVAsQ0FBZDtBQUNBQSxJQUFBQSxHQUFHLEdBQUlBLEdBQUcsSUFBSSxDQUFSLEdBQWEsTUFBbkI7QUFDQUEsSUFBQUEsR0FBRyxHQUFHQSxHQUFHLEdBQUdFLEdBQU4sR0FBWUgsUUFBUSxDQUFFRSxLQUFJLElBQUksQ0FBVCxHQUFjLEdBQWYsQ0FBMUI7QUFDRDs7QUFFRCxTQUFPRCxHQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGSVRTREsgfSBmcm9tICcuL3Nkayc7XG5pbXBvcnQgeyBnZXRGaXRNZXNzYWdlLCBnZXRGaXRNZXNzYWdlQmFzZVR5cGUgfSBmcm9tICcuL21lc3NhZ2VzJztcbmltcG9ydCB7IFR5cGVEZWYsIERlZiwgTWVzc2FnZSwgRmllbGRzLCBNZXNzYWdlVHlwZXMsXG4gIERldmVsb3BlckZpZWxkcywgRml0UGFyc2VyT3B0aW9ucywgUmVhZFJlc3VsdCB9IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgZnVuY3Rpb24gYWRkRW5kaWFuKGxpdHRsZUVuZGlhbjogYm9vbGVhbiwgYnl0ZXM6IG51bWJlcltdKTogbnVtYmVyIHtcbiAgbGV0IHJlc3VsdCA9IDA7XG4gIGlmICghbGl0dGxlRW5kaWFuKSBieXRlcy5yZXZlcnNlKCk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYnl0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICByZXN1bHQgKz0gKGJ5dGVzW2ldIDw8IChpIDw8IDMpKSA+Pj4gMDtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG4gIFxuZnVuY3Rpb24gcmVhZERhdGEoYmxvYjogVWludDhBcnJheSwgZkRlZjogRGVmLCBzdGFydEluZGV4OiBudW1iZXIsXG4gIG9wdGlvbnM6IEZpdFBhcnNlck9wdGlvbnMpOiBudW1iZXJ8bnVtYmVyW118c3RyaW5nIHtcbiAgaWYgKGZEZWYuZW5kaWFuQWJpbGl0eSA9PT0gdHJ1ZSkge1xuICAgIGNvbnN0IHRlbXAgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZEZWYuc2l6ZTsgaSsrKSB7XG4gICAgICB0ZW1wLnB1c2goYmxvYltzdGFydEluZGV4ICsgaV0pO1xuICAgIH1cblxuICAgIGNvbnN0IHsgYnVmZmVyIH0gPSBuZXcgVWludDhBcnJheSh0ZW1wKTtcbiAgICBjb25zdCBkYXRhVmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpO1xuXG4gICAgdHJ5IHtcbiAgICAgIHN3aXRjaCAoZkRlZi50eXBlKSB7XG4gICAgICAgIGNhc2UgJ3NpbnQxNic6XG4gICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldEludDE2KDAsIGZEZWYubGl0dGxlRW5kaWFuKTtcbiAgICAgICAgY2FzZSAndWludDE2JzpcbiAgICAgICAgY2FzZSAndWludDE2eic6XG4gICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldFVpbnQxNigwLCBmRGVmLmxpdHRsZUVuZGlhbik7XG4gICAgICAgIGNhc2UgJ3NpbnQzMic6XG4gICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldEludDMyKDAsIGZEZWYubGl0dGxlRW5kaWFuKTtcbiAgICAgICAgY2FzZSAndWludDMyJzpcbiAgICAgICAgY2FzZSAndWludDMyeic6XG4gICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldFVpbnQzMigwLCBmRGVmLmxpdHRsZUVuZGlhbik7XG4gICAgICAgIGNhc2UgJ2Zsb2F0MzInOlxuICAgICAgICAgIHJldHVybiBkYXRhVmlldy5nZXRGbG9hdDMyKDAsIGZEZWYubGl0dGxlRW5kaWFuKTtcbiAgICAgICAgY2FzZSAnZmxvYXQ2NCc6XG4gICAgICAgICAgcmV0dXJuIGRhdGFWaWV3LmdldEZsb2F0NjQoMCwgZkRlZi5saXR0bGVFbmRpYW4pO1xuICAgICAgICBjYXNlICd1aW50MTZfYXJyYXknOiB7XG4gICAgICAgICAgY29uc3QgYXJyYXkgPSBbXTtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZEZWYuc2l6ZTsgaSArPSAyKSB7XG4gICAgICAgICAgICBhcnJheS5wdXNoKGRhdGFWaWV3LmdldFVpbnQxNihpLCBmRGVmLmxpdHRsZUVuZGlhbikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyBFcnJvcignTm8gdHlwZScpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmICghb3B0aW9ucy5mb3JjZSkge1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhZGRFbmRpYW4oZkRlZi5saXR0bGVFbmRpYW4sIHRlbXApO1xuICB9XG5cbiAgaWYgKGZEZWYudHlwZSA9PT0gJ3N0cmluZycpIHtcbiAgICBjb25zdCB0ZW1wID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmRGVmLnNpemU7IGkrKykge1xuICAgICAgaWYgKGJsb2Jbc3RhcnRJbmRleCArIGldKSB7XG4gICAgICAgIHRlbXAucHVzaChibG9iW3N0YXJ0SW5kZXggKyBpXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBCdWZmZXIuZnJvbSh0ZW1wKS50b1N0cmluZygndXRmLTgnKTtcbiAgfVxuXG4gIGlmIChmRGVmLnR5cGUgPT09ICdieXRlX2FycmF5Jykge1xuICAgIGNvbnN0IHRlbXAgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZEZWYuc2l6ZTsgaSsrKSB7XG4gICAgICB0ZW1wLnB1c2goYmxvYltzdGFydEluZGV4ICsgaV0pO1xuICAgIH1cbiAgICByZXR1cm4gdGVtcDtcbiAgfVxuXG4gIHJldHVybiBibG9iW3N0YXJ0SW5kZXhdO1xufVxuXG5mdW5jdGlvbiBmb3JtYXRCeVR5cGUoZGF0YTogYW55LCB0eXBlOiBzdHJpbmcsXG4gIHNjYWxlOiBudW1iZXIsIG9mZnNldDogbnVtYmVyKTogYW55IHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSAnZGF0ZV90aW1lJzpcbiAgICBjYXNlICdsb2NhbF9kYXRlX3RpbWUnOlxuICAgICAgcmV0dXJuIG5ldyBEYXRlKChkYXRhICogMTAwMCkgKyA2MzEwNjU2MDAwMDApO1xuICAgIGNhc2UgJ3NpbnQzMic6XG4gICAgICByZXR1cm4gZGF0YSAqIEZJVFNESy5zY0NvbnN0O1xuICAgIGNhc2UgJ3NpbnQxNic6XG4gICAgY2FzZSAndWludDMyJzpcbiAgICBjYXNlICd1aW50MTYnOlxuICAgICAgcmV0dXJuIHNjYWxlID8gZGF0YSAvIHNjYWxlICsgb2Zmc2V0IDogZGF0YTtcbiAgICBjYXNlICd1aW50MTZfYXJyYXknOlxuICAgICAgY29uc3QgZGF0YV9hcnJheSA9IGRhdGEgYXMgbnVtYmVyW11cbiAgICAgIHJldHVybiBkYXRhLm1hcCgoZGF0YUl0ZW06IG51bWJlcikgPT4ge1xuICAgICAgICBpZiAoc2NhbGUpIHtcbiAgICAgICAgICByZXR1cm4gZGF0YUl0ZW0gLyBzY2FsZSArIG9mZnNldDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGF0YUl0ZW07XG4gICAgICB9KTtcbiAgICBkZWZhdWx0OiB7XG4gICAgICBpZiAoIUZJVFNESy50eXBlcy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkge1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHR5cGVzID0gRklUU0RLLnR5cGVzW3R5cGVdXG4gICAgICAvLyBRdWljayBjaGVjayBmb3IgYSBtYXNrXG4gICAgICBjb25zdCB2YWx1ZXM6IHN0cmluZ1tdID0gW107XG4gICAgICBPYmplY3Qua2V5cyh0eXBlcykuZm9yRWFjaCgoa2V5LCBfKSA9PiB7XG4gICAgICAgIHZhbHVlcy5wdXNoKHR5cGVzW2tleV0pO1xuICAgICAgfSk7XG4gICAgICBpZiAodmFsdWVzLmluZGV4T2YoJ21hc2snKSA9PT0gLTEpIHtcbiAgICAgICAgcmV0dXJuIHR5cGVzW2RhdGFdO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YUl0ZW06IHsgW2tleTogc3RyaW5nXTogbnVtYmVyfGJvb2xlYW4gfSA9IHt9O1xuICAgICAgT2JqZWN0LmtleXModHlwZXMpLmZvckVhY2goKGtleTogc3RyaW5nLCBfOiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHR5cGVzW2tleV1cbiAgICAgICAgaWYgKGl0ZW0gPT09ICdtYXNrJykge1xuICAgICAgICAgIGRhdGFJdGVtWyd2YWx1ZSddID0gZGF0YSAmIHBhcnNlSW50KGtleSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGF0YUl0ZW1baXRlbV0gPSAhISgoZGF0YSAmIHBhcnNlSW50KGtleSkpID4+IDcpO1xuICAgICAgICAgIC8vIE5vdCBzdXJlIGlmIHdlIG5lZWQgdGhlID4+IDcgYW5kIGNhc3RpbmcgdG8gYm9vbGVhbiBidXQgZnJvbSBhbGxcbiAgICAgICAgICAvLyB0aGUgbWFza2VkIHByb3BzIG9mIGZpZWxkcyBzbyBmYXIgdGhpcyBzZWVtcyB0byBiZSB0aGUgY2FzZVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkYXRhSXRlbTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNJbnZhbGlkVmFsdWUoZGF0YTogYW55LCB0eXBlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgc3dpdGNoICh0eXBlKSB7XG4gICAgY2FzZSAnZW51bSc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHhGRjtcbiAgICBjYXNlICdzaW50OCc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHg3RjtcbiAgICBjYXNlICd1aW50OCc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHhGRjtcbiAgICBjYXNlICdzaW50MTYnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4N0ZGRjtcbiAgICBjYXNlICd1aW50MTYnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkZGRjtcbiAgICBjYXNlICdzaW50MzInOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4N0ZGRkZGRkY7XG4gICAgY2FzZSAndWludDMyJzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGRkZGRkZGO1xuICAgIGNhc2UgJ3N0cmluZyc6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDtcbiAgICBjYXNlICdmbG9hdDMyJzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGRkZGRkZGO1xuICAgIGNhc2UgJ2Zsb2F0NjQnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkZGRkZGRkZGRkZGRkZGRjtcbiAgICBjYXNlICd1aW50OHonOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4MDA7XG4gICAgY2FzZSAndWludDE2eic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDAwO1xuICAgIGNhc2UgJ3VpbnQzMnonOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4MDAwMDAwO1xuICAgIGNhc2UgJ2J5dGUnOlxuICAgICAgcmV0dXJuIGRhdGEgPT09IDB4RkY7XG4gICAgY2FzZSAnc2ludDY0JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweDdGRkZGRkZGRkZGRkZGRkY7XG4gICAgY2FzZSAndWludDY0JzpcbiAgICAgIHJldHVybiBkYXRhID09PSAweEZGRkZGRkZGRkZGRkZGRkY7XG4gICAgY2FzZSAndWludDY0eic6XG4gICAgICByZXR1cm4gZGF0YSA9PT0gMHgwMDAwMDAwMDAwMDAwMDAwO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gY29udmVydFRvKGRhdGE6IGFueSwgdW5pdHNMaXN0OiBzdHJpbmcsIHNwZWVkVW5pdDogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgdW5pdE9iaiA9IEZJVFNESy5vcHRpb25zW3VuaXRzTGlzdF1bc3BlZWRVbml0XTtcbiAgcmV0dXJuIHVuaXRPYmogPyBkYXRhICogdW5pdE9iai5tdWx0aXBsaWVyICsgdW5pdE9iai5vZmZzZXQgOiBkYXRhO1xufVxuXG5mdW5jdGlvbiBhcHBseU9wdGlvbnMoZGF0YTogYW55LCBmaWVsZDogc3RyaW5nLCBvcHRpb25zOiBGaXRQYXJzZXJPcHRpb25zKTogYW55IHtcbiAgc3dpdGNoIChmaWVsZCkge1xuICAgIGNhc2UgJ3NwZWVkJzpcbiAgICBjYXNlICdlbmhhbmNlZF9zcGVlZCc6XG4gICAgY2FzZSAndmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ2F2Z19zcGVlZCc6XG4gICAgY2FzZSAnbWF4X3NwZWVkJzpcbiAgICBjYXNlICdzcGVlZF8xcyc6XG4gICAgY2FzZSAnYmFsbF9zcGVlZCc6XG4gICAgY2FzZSAnZW5oYW5jZWRfYXZnX3NwZWVkJzpcbiAgICBjYXNlICdlbmhhbmNlZF9tYXhfc3BlZWQnOlxuICAgIGNhc2UgJ2F2Z19wb3NfdmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ21heF9wb3NfdmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ2F2Z19uZWdfdmVydGljYWxfc3BlZWQnOlxuICAgIGNhc2UgJ21heF9uZWdfdmVydGljYWxfc3BlZWQnOlxuICAgICAgcmV0dXJuIGNvbnZlcnRUbyhkYXRhLCAnc3BlZWRVbml0cycsIG9wdGlvbnMuc3BlZWRVbml0KTtcbiAgICBjYXNlICdkaXN0YW5jZSc6XG4gICAgY2FzZSAndG90YWxfZGlzdGFuY2UnOlxuICAgIGNhc2UgJ2VuaGFuY2VkX2F2Z19hbHRpdHVkZSc6XG4gICAgY2FzZSAnZW5oYW5jZWRfbWluX2FsdGl0dWRlJzpcbiAgICBjYXNlICdlbmhhbmNlZF9tYXhfYWx0aXR1ZGUnOlxuICAgIGNhc2UgJ2VuaGFuY2VkX2FsdGl0dWRlJzpcbiAgICBjYXNlICdoZWlnaHQnOlxuICAgIGNhc2UgJ29kb21ldGVyJzpcbiAgICBjYXNlICdhdmdfc3Ryb2tlX2Rpc3RhbmNlJzpcbiAgICBjYXNlICdtaW5fYWx0aXR1ZGUnOlxuICAgIGNhc2UgJ2F2Z19hbHRpdHVkZSc6XG4gICAgY2FzZSAnbWF4X2FsdGl0dWRlJzpcbiAgICBjYXNlICd0b3RhbF9hc2NlbnQnOlxuICAgIGNhc2UgJ3RvdGFsX2Rlc2NlbnQnOlxuICAgIGNhc2UgJ2FsdGl0dWRlJzpcbiAgICBjYXNlICdjeWNsZV9sZW5ndGgnOlxuICAgIGNhc2UgJ2F1dG9fd2hlZWxzaXplJzpcbiAgICBjYXNlICdjdXN0b21fd2hlZWxzaXplJzpcbiAgICBjYXNlICdncHNfYWNjdXJhY3knOlxuICAgICAgcmV0dXJuIGNvbnZlcnRUbyhkYXRhLCAnbGVuZ3RoVW5pdHMnLCBvcHRpb25zLmxlbmd0aFVuaXQpO1xuICAgIGNhc2UgJ3RlbXBlcmF0dXJlJzpcbiAgICBjYXNlICdhdmdfdGVtcGVyYXR1cmUnOlxuICAgIGNhc2UgJ21heF90ZW1wZXJhdHVyZSc6XG4gICAgICByZXR1cm4gY29udmVydFRvKGRhdGEsICd0ZW1wZXJhdHVyZVVuaXRzJywgb3B0aW9ucy50ZW1wZXJhdHVyZVVuaXQpO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZGF0YTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZFJlY29yZChibG9iOiBVaW50OEFycmF5LCBtZXNzYWdlVHlwZXM6IE1lc3NhZ2VUeXBlcyxcbiAgZGV2ZWxvcGVyRmllbGRzOiBEZXZlbG9wZXJGaWVsZHMsXG4gIHN0YXJ0SW5kZXg6IG51bWJlciwgb3B0aW9uczogRml0UGFyc2VyT3B0aW9ucyxcbiAgc3RhcnREYXRlOiBudW1iZXIsIHBhdXNlZFRpbWU6IG51bWJlcik6IFJlYWRSZXN1bHQge1xuICBjb25zdCByZWNvcmRIZWFkZXIgPSBibG9iW3N0YXJ0SW5kZXhdO1xuICBjb25zdCBsb2NhbE1lc3NhZ2VUeXBlID0gcmVjb3JkSGVhZGVyICYgMTU7XG5cbiAgaWYgKChyZWNvcmRIZWFkZXIgJiA2NCkgPT09IDY0KSB7XG4gICAgLy8gaXMgZGVmaW5pdGlvbiBtZXNzYWdlXG4gICAgLy8gc3RhcnRJbmRleCArIDEgaXMgcmVzZXJ2ZWRcblxuICAgIGNvbnN0IGhhc0RldmVsb3BlckRhdGEgPSAocmVjb3JkSGVhZGVyICYgMzIpID09PSAzMjtcbiAgICBjb25zdCBsRW5kID0gYmxvYltzdGFydEluZGV4ICsgMl0gPT09IDA7XG4gICAgY29uc3QgbnVtYmVyT2ZGaWVsZHMgPSBibG9iW3N0YXJ0SW5kZXggKyA1XTtcbiAgICBjb25zdCBudW1iZXJPZkRldmVsb3BlckRhdGFGaWVsZHMgPSBoYXNEZXZlbG9wZXJEYXRhID8gYmxvYltzdGFydEluZGV4ICsgNSArIG51bWJlck9mRmllbGRzICogMyArIDFdIDogMDtcblxuICAgIGNvbnN0IG1UeXBlRGVmOiBUeXBlRGVmID0ge1xuICAgICAgbGl0dGxlRW5kaWFuOiBsRW5kLFxuICAgICAgZ2xvYmFsTWVzc2FnZU51bWJlcjogYWRkRW5kaWFuKGxFbmQsIFtibG9iW3N0YXJ0SW5kZXggKyAzXSwgYmxvYltzdGFydEluZGV4ICsgNF1dKSxcbiAgICAgIG51bWJlck9mRmllbGRzOiBudW1iZXJPZkZpZWxkcyArIG51bWJlck9mRGV2ZWxvcGVyRGF0YUZpZWxkcyxcbiAgICAgIGZpZWxkRGVmczogW10sXG4gICAgfTtcblxuICAgIGNvbnN0IG1lc3NhZ2UgPSBnZXRGaXRNZXNzYWdlKG1UeXBlRGVmLmdsb2JhbE1lc3NhZ2VOdW1iZXIpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkZpZWxkczsgaSsrKSB7XG4gICAgICBjb25zdCBmRGVmSW5kZXggPSBzdGFydEluZGV4ICsgNiArIChpICogMyk7XG4gICAgICBjb25zdCBiYXNlVHlwZSA9IGJsb2JbZkRlZkluZGV4ICsgMl07XG4gICAgICBjb25zdCB7IGZpZWxkLCB0eXBlIH0gPSBtZXNzYWdlLmdldEF0dHJpYnV0ZXMoYmxvYltmRGVmSW5kZXhdKTsgXG4gICAgICBjb25zdCBmRGVmID0ge1xuICAgICAgICB0eXBlLFxuICAgICAgICBmRGVmTm86IGJsb2JbZkRlZkluZGV4XSxcbiAgICAgICAgc2l6ZTogYmxvYltmRGVmSW5kZXggKyAxXSxcbiAgICAgICAgZW5kaWFuQWJpbGl0eTogKGJhc2VUeXBlICYgMTI4KSA9PT0gMTI4LFxuICAgICAgICBsaXR0bGVFbmRpYW46IGxFbmQsXG4gICAgICAgIGJhc2VUeXBlTm86IChiYXNlVHlwZSAmIDE1KSxcbiAgICAgICAgbmFtZTogZmllbGQsXG4gICAgICAgIGRhdGFUeXBlOiBnZXRGaXRNZXNzYWdlQmFzZVR5cGUoYmFzZVR5cGUgJiAxNSksXG4gICAgICB9O1xuXG4gICAgICAgIG1UeXBlRGVmLmZpZWxkRGVmcy5wdXNoKGZEZWYpO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZEZXZlbG9wZXJEYXRhRmllbGRzOyBpKyspIHtcbiAgICAgIC8vIElmIHdlIGZhaWwgdG8gcGFyc2UgdGhlbiB0cnkgY2F0Y2hcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZEZWZJbmRleCA9IHN0YXJ0SW5kZXggKyA2ICsgKG51bWJlck9mRmllbGRzICogMykgKyAxICsgKGkgKiAzKTtcblxuICAgICAgICBjb25zdCBmaWVsZE51bSA9IGJsb2JbZkRlZkluZGV4XTtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IGJsb2JbZkRlZkluZGV4ICsgMV07XG4gICAgICAgIGNvbnN0IGRldkRhdGFJbmRleCA9IGJsb2JbZkRlZkluZGV4ICsgMl07XG5cbiAgICAgICAgY29uc3QgZGV2RGVmID0gZGV2ZWxvcGVyRmllbGRzW2RldkRhdGFJbmRleF1bZmllbGROdW1dO1xuXG4gICAgICAgIGNvbnN0IGJhc2VUeXBlID0gZGV2RGVmLmZpdF9iYXNlX3R5cGVfaWQ7XG5cbiAgICAgICAgY29uc3QgZkRlZiA9IHtcbiAgICAgICAgICB0eXBlOiBGSVRTREsudHlwZXMuZml0X2Jhc2VfdHlwZVtiYXNlVHlwZV0sXG4gICAgICAgICAgc2l6ZSxcbiAgICAgICAgICBmRGVmTm86IGZpZWxkTnVtLFxuICAgICAgICAgIGVuZGlhbkFiaWxpdHk6IChiYXNlVHlwZSAmIDEyOCkgPT09IDEyOCxcbiAgICAgICAgICBsaXR0bGVFbmRpYW46IGxFbmQsXG4gICAgICAgICAgYmFzZVR5cGVObzogKGJhc2VUeXBlICYgMTUpLFxuICAgICAgICAgIG5hbWU6IGRldkRlZi5maWVsZF9uYW1lLFxuICAgICAgICAgIGRhdGFUeXBlOiBnZXRGaXRNZXNzYWdlQmFzZVR5cGUoYmFzZVR5cGUgJiAxNSksXG4gICAgICAgICAgc2NhbGU6IGRldkRlZi5zY2FsZSB8fCAxLFxuICAgICAgICAgIG9mZnNldDogZGV2RGVmLm9mZnNldCB8fCAwLFxuICAgICAgICAgIGRldmVsb3BlckRhdGFJbmRleDogZGV2RGF0YUluZGV4LFxuICAgICAgICAgIGlzRGV2ZWxvcGVyRmllbGQ6IHRydWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgbVR5cGVEZWYuZmllbGREZWZzLnB1c2goZkRlZik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmZvcmNlKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBtZXNzYWdlVHlwZXNbbG9jYWxNZXNzYWdlVHlwZV0gPSBtVHlwZURlZjtcblxuICAgIGNvbnN0IG5leHRJbmRleCA9IHN0YXJ0SW5kZXggKyA2ICsgKG1UeXBlRGVmLm51bWJlck9mRmllbGRzICogMyk7XG4gICAgY29uc3QgbmV4dEluZGV4V2l0aERldmVsb3BlckRhdGEgPSBuZXh0SW5kZXggKyAxO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIG1lc3NhZ2VUeXBlOiAnZGVmaW5pdGlvbicsXG4gICAgICBuZXh0SW5kZXg6IGhhc0RldmVsb3BlckRhdGEgPyBuZXh0SW5kZXhXaXRoRGV2ZWxvcGVyRGF0YSA6IG5leHRJbmRleCxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgbWVzc2FnZVR5cGUgPSBtZXNzYWdlVHlwZXNbbG9jYWxNZXNzYWdlVHlwZV0gfHwgbWVzc2FnZVR5cGVzWzBdO1xuXG4gIC8vIFRPRE86IGhhbmRsZSBjb21wcmVzc2VkIGhlYWRlciAoKHJlY29yZEhlYWRlciAmIDEyOCkgPT0gMTI4KVxuXG4gIC8vIHVuY29tcHJlc3NlZCBoZWFkZXJcbiAgbGV0IG1lc3NhZ2VTaXplID0gMDtcbiAgbGV0IHJlYWREYXRhRnJvbUluZGV4ID0gc3RhcnRJbmRleCArIDE7XG4gIGNvbnN0IGZpZWxkczogRmllbGRzID0ge307XG5cbiAgY29uc3QgbWVzc2FnZSA9IGdldEZpdE1lc3NhZ2UobWVzc2FnZVR5cGUuZ2xvYmFsTWVzc2FnZU51bWJlcik7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZXNzYWdlVHlwZS5maWVsZERlZnMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBmRGVmID0gbWVzc2FnZVR5cGUuZmllbGREZWZzW2ldO1xuICAgIGNvbnN0IGRhdGEgPSByZWFkRGF0YShibG9iLCBmRGVmLCByZWFkRGF0YUZyb21JbmRleCwgb3B0aW9ucyk7XG5cbiAgICBpZiAoIWlzSW52YWxpZFZhbHVlKGRhdGEsIGZEZWYudHlwZSkpIHtcbiAgICAgIGlmIChmRGVmLmlzRGV2ZWxvcGVyRmllbGQpIHtcbiAgICAgICAgY29uc3QgZmllbGQgPSBmRGVmLm5hbWU7XG4gICAgICAgIGNvbnN0IHsgdHlwZSwgc2NhbGUsIG9mZnNldCB9ID0gZkRlZjtcblxuICAgICAgICBmaWVsZHNbZkRlZi5uYW1lXSA9IGFwcGx5T3B0aW9ucyhmb3JtYXRCeVR5cGUoZGF0YSwgdHlwZSwgc2NhbGUsIG9mZnNldCksIGZpZWxkLCBvcHRpb25zKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHsgZmllbGQsIHR5cGUsIHNjYWxlLCBvZmZzZXQgfSA9IG1lc3NhZ2UuZ2V0QXR0cmlidXRlcyhmRGVmLmZEZWZObyk7XG5cbiAgICAgICAgaWYgKGZpZWxkICE9PSAndW5rbm93bicgJiYgZmllbGQgIT09ICcnICYmIGZpZWxkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBmaWVsZHNbZmllbGRdID0gYXBwbHlPcHRpb25zKGZvcm1hdEJ5VHlwZShkYXRhLCB0eXBlLCBzY2FsZSwgb2Zmc2V0KSwgZmllbGQsIG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChtZXNzYWdlLm5hbWUgPT09ICdyZWNvcmQnICYmIG9wdGlvbnMuZWxhcHNlZFJlY29yZEZpZWxkKSB7XG4gICAgICAgIGZpZWxkcy5lbGFwc2VkX3RpbWUgPSAoZmllbGRzLnRpbWVzdGFtcCAtIHN0YXJ0RGF0ZSkgLyAxMDAwO1xuICAgICAgICBmaWVsZHMudGltZXJfdGltZSA9IGZpZWxkcy5lbGFwc2VkX3RpbWUgLSBwYXVzZWRUaW1lO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJlYWREYXRhRnJvbUluZGV4ICs9IGZEZWYuc2l6ZTtcbiAgICBtZXNzYWdlU2l6ZSArPSBmRGVmLnNpemU7XG4gIH1cblxuICBpZiAobWVzc2FnZS5uYW1lID09PSAnZmllbGRfZGVzY3JpcHRpb24nKSB7XG4gICAgZGV2ZWxvcGVyRmllbGRzW2ZpZWxkcy5kZXZlbG9wZXJfZGF0YV9pbmRleF0gPSBkZXZlbG9wZXJGaWVsZHNbZmllbGRzLmRldmVsb3Blcl9kYXRhX2luZGV4XSB8fCBbXTtcbiAgICBkZXZlbG9wZXJGaWVsZHNbZmllbGRzLmRldmVsb3Blcl9kYXRhX2luZGV4XVtmaWVsZHMuZmllbGRfZGVmaW5pdGlvbl9udW1iZXJdID0gZmllbGRzO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0ge1xuICAgIG1lc3NhZ2VUeXBlOiBtZXNzYWdlLm5hbWUsXG4gICAgbmV4dEluZGV4OiBzdGFydEluZGV4ICsgbWVzc2FnZVNpemUgKyAxLFxuICAgIG1lc3NhZ2U6IGZpZWxkcyxcbiAgfTtcblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXJyYXlCdWZmZXIoYnVmZmVyOiBBcnJheUJ1ZmZlcnxCdWZmZXIpIHtcbiAgaWYgKGJ1ZmZlciBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7XG4gICAgcmV0dXJuIGJ1ZmZlcjtcbiAgfVxuICBjb25zdCBhYiA9IG5ldyBBcnJheUJ1ZmZlcihidWZmZXIubGVuZ3RoKTtcbiAgY29uc3QgdmlldyA9IG5ldyBVaW50OEFycmF5KGFiKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBidWZmZXIubGVuZ3RoOyArK2kpIHtcbiAgICB2aWV3W2ldID0gYnVmZmVyW2ldO1xuICB9XG4gIHJldHVybiBhYjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUNSQyhibG9iOiBVaW50OEFycmF5LCBzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikge1xuICBjb25zdCBjcmNUYWJsZSA9IFtcbiAgICAweDAwMDAsIDB4Q0MwMSwgMHhEODAxLCAweDE0MDAsIDB4RjAwMSwgMHgzQzAwLCAweDI4MDAsIDB4RTQwMSxcbiAgICAweEEwMDEsIDB4NkMwMCwgMHg3ODAwLCAweEI0MDEsIDB4NTAwMCwgMHg5QzAxLCAweDg4MDEsIDB4NDQwMCxcbiAgXTtcblxuICBsZXQgY3JjID0gMDtcbiAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICBjb25zdCBieXRlID0gYmxvYltpXTtcbiAgICBsZXQgdG1wID0gY3JjVGFibGVbY3JjICYgMHhGXTtcbiAgICBjcmMgPSAoY3JjID4+IDQpICYgMHgwRkZGO1xuICAgIGNyYyA9IGNyYyBeIHRtcCBeIGNyY1RhYmxlW2J5dGUgJiAweEZdO1xuICAgIHRtcCA9IGNyY1RhYmxlW2NyYyAmIDB4Rl07XG4gICAgY3JjID0gKGNyYyA+PiA0KSAmIDB4MEZGRjtcbiAgICBjcmMgPSBjcmMgXiB0bXAgXiBjcmNUYWJsZVsoYnl0ZSA+PiA0KSAmIDB4Rl07XG4gIH1cblxuICByZXR1cm4gY3JjO1xufVxuIl19